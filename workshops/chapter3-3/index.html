
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Advanced techniques that enhance trust, reasoning quality, and error prevention in RAG systems using citations, chain of thought, and validation">
      
      
      
        <link rel="canonical" href="https://567-labs.github.io/systematically-improving-rag/workshops/chapter3-3/">
      
      
        <link rel="prev" href="../chapter3-2/">
      
      
        <link rel="next" href="../chapter4-1/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Quality of Life Improvements - Systematically Improving RAG Applications</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config",""),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="black">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#33-quality-of-life-improvements-citations-chain-of-thought-and-validation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
              <button class="md-banner__button md-icon" aria-label="Don't show this again">
                
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
              </button>
            
            
  <p>
    This material is supported by <a href="https://maven.com/applied-llms/rag-playbook?promoCode=EBOOK" target="_blank"><strong>Applied LLMs on Maven</strong></a>.  Readers get 20% off.
    Not ready? Check out the <a href="https://fivesixseven.ck.page/rag-crash-course" target="_blank"><strong>free email course</strong></a>.
  </p>

          </div>
          
            <script>var el=document.querySelector("[data-md-component=announce]");if(el){var content=el.querySelector(".md-typeset");__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0)}</script>
          
        </aside>
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Systematically Improving RAG Applications" class="md-header__button md-logo" aria-label="Systematically Improving RAG Applications" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Systematically Improving RAG Applications
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Quality of Life Improvements
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="black"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
    
  
  Workshops

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../office-hours/" class="md-tabs__link">
          
  
  
    
  
  Office Hours

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../talks/" class="md-tabs__link">
          
  
  
    
  
  Talks

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Systematically Improving RAG Applications" class="md-nav__button md-logo" aria-label="Systematically Improving RAG Applications" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Systematically Improving RAG Applications
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Workshops
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Workshops
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Chapter 1: Starting the Flywheel
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Chapter 1: Starting the Flywheel
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Chapter 2: From Evaluation to Enhancement
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Chapter 2: From Evaluation to Enhancement
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" checked>
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Chapter 3: User Experience
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            Chapter 3: User Experience
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter3-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Design Principles
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter3-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Feedback Collection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Iterative Improvement
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Iterative Improvement
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction-from-functional-to-exceptional" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction: From Functional to Exceptional
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#beyond-the-basics-elevating-user-experience" class="md-nav__link">
    <span class="md-ellipsis">
      Beyond the Basics: Elevating User Experience
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#citations-building-trust-through-transparency" class="md-nav__link">
    <span class="md-ellipsis">
      Citations: Building Trust Through Transparency
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Citations: Building Trust Through Transparency">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-dual-purpose-of-citations" class="md-nav__link">
    <span class="md-ellipsis">
      The Dual Purpose of Citations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#crafting-citation-rich-responses" class="md-nav__link">
    <span class="md-ellipsis">
      Crafting Citation-Rich Responses
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-citation-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Citation Implementation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Citation Implementation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xml-based-citation-approach" class="md-nav__link">
    <span class="md-ellipsis">
      XML-Based Citation Approach
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fine-tuning-for-citation-accuracy" class="md-nav__link">
    <span class="md-ellipsis">
      Fine-Tuning for Citation Accuracy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation Best Practices
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chain-of-thought-making-thinking-visible" class="md-nav__link">
    <span class="md-ellipsis">
      Chain of Thought: Making Thinking Visible
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chain of Thought: Making Thinking Visible">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-underutilized-superpower" class="md-nav__link">
    <span class="md-ellipsis">
      The Underutilized Superpower
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monologues-solving-the-context-management-problem" class="md-nav__link">
    <span class="md-ellipsis">
      Monologues: Solving the Context Management Problem
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Monologues: Solving the Context Management Problem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning-in-limited-windows" class="md-nav__link">
    <span class="md-ellipsis">
      Reasoning in Limited Windows
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validation-patterns-the-safety-net-approach" class="md-nav__link">
    <span class="md-ellipsis">
      Validation Patterns: The Safety Net Approach
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Validation Patterns: The Safety Net Approach">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#catching-errors-before-they-reach-users" class="md-nav__link">
    <span class="md-ellipsis">
      Catching Errors Before They Reach Users
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-practical-example-url-validation" class="md-nav__link">
    <span class="md-ellipsis">
      A Practical Example: URL Validation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#strategic-rejection-of-work" class="md-nav__link">
    <span class="md-ellipsis">
      Strategic Rejection of Work
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Strategic Rejection of Work">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#when-i-dont-know-is-the-right-answer" class="md-nav__link">
    <span class="md-ellipsis">
      When "I Don't Know" is the Right Answer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#showcasing-capabilities" class="md-nav__link">
    <span class="md-ellipsis">
      Showcasing Capabilities
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Showcasing Capabilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#guide-users-to-what-you-do-well" class="md-nav__link">
    <span class="md-ellipsis">
      Guide Users to What You Do Well
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#putting-it-all-together-the-complete-experience" class="md-nav__link">
    <span class="md-ellipsis">
      Putting It All Together: The Complete Experience
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preparing-for-the-next-chapter" class="md-nav__link">
    <span class="md-ellipsis">
      Preparing for the Next Chapter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion-the-complete-rag-experience" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion: The Complete RAG Experience
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Chapter 4: Topic Modeling
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            Chapter 4: Topic Modeling
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter4-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Analysis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter4-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prioritization
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_7" >
        
          
          <label class="md-nav__link" for="__nav_2_7" id="__nav_2_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Chapter 5: Multimodal Capabilities
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            Chapter 5: Multimodal Capabilities
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter5-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Understanding
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter5-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Implementation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_8" >
        
          
          <label class="md-nav__link" for="__nav_2_8" id="__nav_2_8_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Chapter 6: Architecture
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_8">
            <span class="md-nav__icon md-icon"></span>
            Chapter 6: Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter6-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Routing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter6-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tools
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter6-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Improvement
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../office-hours/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Office Hours
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Office Hours
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../office-hours/faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FAQ
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../office-hours/AGENTS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Agents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 1: Starting the Flywheel
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Chapter 1: Starting the Flywheel
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../office-hours/cohort2/week1-summary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cohort 2 - Week 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../office-hours/cohort3/week-1-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cohort 3 - Session 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../office-hours/cohort3/week-1-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cohort 3 - Session 2
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 2: From Evaluation to Enhancement
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            Chapter 2: From Evaluation to Enhancement
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../office-hours/cohort2/week2-summary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cohort 2 - Week 2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../office-hours/cohort3/week-2-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cohort 3 - Session 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../office-hours/cohort3/week-2-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cohort 3 - Session 2
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 3: User Experience
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            Chapter 3: User Experience
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../office-hours/cohort2/week3-summary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cohort 2 - Week 3
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../office-hours/cohort3/week-3-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cohort 3 - Session 1
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_7" >
        
          
          <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 4: Topic Modeling
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            Chapter 4: Topic Modeling
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../office-hours/cohort2/week4-summary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cohort 2 - Week 4
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../office-hours/cohort3/week-4-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cohort 3 - Session 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../office-hours/cohort3/week-4-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cohort 3 - Session 2
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_8" >
        
          
          <label class="md-nav__link" for="__nav_3_8" id="__nav_3_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 5: Multimodal Capabilities
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8">
            <span class="md-nav__icon md-icon"></span>
            Chapter 5: Multimodal Capabilities
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../office-hours/cohort2/week5-summary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cohort 2 - Week 5
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../office-hours/cohort3/week-5-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cohort 3 - Session 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../office-hours/cohort3/week-5-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cohort 3 - Session 2
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_9" >
        
          
          <label class="md-nav__link" for="__nav_3_9" id="__nav_3_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 6: Architecture
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_9">
            <span class="md-nav__icon md-icon"></span>
            Chapter 6: Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../office-hours/cohort2/week6-summary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cohort 2 - Week 6
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../talks/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Talks
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Talks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Search / Indexing / Chunking
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Search / Indexing / Chunking
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../talks/chromadb-anton-chunking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Text Chunking Strategies (Anton, ChromaDB)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../talks/john-lexical-search/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lexical Search in RAG Applications (John Berryman)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../talks/query-routing-anton/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Query Routing for RAG Systems (Anton, ChromaDB)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../talks/semantic-search-exa-will-bryk/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Why Google Search Sucks for AI (Will Bryk, Exa)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../talks/rag-without-apis-browser-michael-struwig/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    How OpenBB Ditched APIs and Put RAG in the Browser (Michael Struwig)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Finetuning
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Finetuning
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../talks/glean-manav/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Building Custom Embedding Models Per Customer (Manav, Glean)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../talks/fine-tuning-rerankers-embeddings-ayush-lancedb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    The 12% RAG Performance Boost You're Missing (Ayush, LanceDB)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../talks/embedding-performance-generative-evals-kelly-hong/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Stop Trusting MTEB Rankings (Kelly Hong, Chroma)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Monitoring
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            Monitoring
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../talks/online-evals-production-monitoring-ben-sidhant/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Why Your AI Is Failing in Production (Ben & Sidhant)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../talks/rag-antipatterns-skylar-payne/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    The RAG Mistakes That Are Killing Your AI (Skylar Payne)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../talks/zapier-vitor-evals/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    How Zapier 4x'd Their AI Feedback Collection (Vitor)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Coding Agents
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            Coding Agents
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../talks/rag-is-dead-cline-nik/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Why Cline Ditched RAG for Direct Code Reading (Nik Pash)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../talks/colin-rag-agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Grep Beat Embeddings on SWE-Bench (Colin Flaherty, Augment)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../talks/sourcegraph-agentic-code-agent-rag/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Agentic RAG from first principles (Beyang Liu, Sourcegraph)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../talks/devin-cognition-multi-agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Why Devin does not use multi-agents (Walden Yan)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_6" >
        
          
          <label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Document Processing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            Document Processing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../talks/reducto-docs-adit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Why Most Document Parsing Sucks (Adit, Reducto)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../talks/superlinked-encoder-stacking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Encoder Stacking and Multi-Modal Retrieval (Daniel, Superlinked)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../talks/extend-document-automation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    How Extend Achieves 95%+ Document Automation (Eli Badgio)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction-from-functional-to-exceptional" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction: From Functional to Exceptional
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#beyond-the-basics-elevating-user-experience" class="md-nav__link">
    <span class="md-ellipsis">
      Beyond the Basics: Elevating User Experience
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#citations-building-trust-through-transparency" class="md-nav__link">
    <span class="md-ellipsis">
      Citations: Building Trust Through Transparency
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Citations: Building Trust Through Transparency">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-dual-purpose-of-citations" class="md-nav__link">
    <span class="md-ellipsis">
      The Dual Purpose of Citations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#crafting-citation-rich-responses" class="md-nav__link">
    <span class="md-ellipsis">
      Crafting Citation-Rich Responses
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-citation-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Citation Implementation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Citation Implementation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xml-based-citation-approach" class="md-nav__link">
    <span class="md-ellipsis">
      XML-Based Citation Approach
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fine-tuning-for-citation-accuracy" class="md-nav__link">
    <span class="md-ellipsis">
      Fine-Tuning for Citation Accuracy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation Best Practices
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chain-of-thought-making-thinking-visible" class="md-nav__link">
    <span class="md-ellipsis">
      Chain of Thought: Making Thinking Visible
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chain of Thought: Making Thinking Visible">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-underutilized-superpower" class="md-nav__link">
    <span class="md-ellipsis">
      The Underutilized Superpower
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monologues-solving-the-context-management-problem" class="md-nav__link">
    <span class="md-ellipsis">
      Monologues: Solving the Context Management Problem
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Monologues: Solving the Context Management Problem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning-in-limited-windows" class="md-nav__link">
    <span class="md-ellipsis">
      Reasoning in Limited Windows
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validation-patterns-the-safety-net-approach" class="md-nav__link">
    <span class="md-ellipsis">
      Validation Patterns: The Safety Net Approach
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Validation Patterns: The Safety Net Approach">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#catching-errors-before-they-reach-users" class="md-nav__link">
    <span class="md-ellipsis">
      Catching Errors Before They Reach Users
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-practical-example-url-validation" class="md-nav__link">
    <span class="md-ellipsis">
      A Practical Example: URL Validation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#strategic-rejection-of-work" class="md-nav__link">
    <span class="md-ellipsis">
      Strategic Rejection of Work
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Strategic Rejection of Work">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#when-i-dont-know-is-the-right-answer" class="md-nav__link">
    <span class="md-ellipsis">
      When "I Don't Know" is the Right Answer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#showcasing-capabilities" class="md-nav__link">
    <span class="md-ellipsis">
      Showcasing Capabilities
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Showcasing Capabilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#guide-users-to-what-you-do-well" class="md-nav__link">
    <span class="md-ellipsis">
      Guide Users to What You Do Well
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#putting-it-all-together-the-complete-experience" class="md-nav__link">
    <span class="md-ellipsis">
      Putting It All Together: The Complete Experience
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preparing-for-the-next-chapter" class="md-nav__link">
    <span class="md-ellipsis">
      Preparing for the Next Chapter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion-the-complete-rag-experience" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion: The Complete RAG Experience
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="33-quality-of-life-improvements-citations-chain-of-thought-and-validation">3.3 Quality of Life Improvements: Citations, Chain of Thought, and Validation</h1>
<div class="admonition abstract">
<p class="admonition-title">Chapter Overview</p>
</div>
<div class="highlight"><pre><span></span><code>This chapter explores essential quality-of-life improvements that transform RAG systems from functional to exceptional. You&#39;ll learn how to implement interactive citations that build trust while collecting valuable feedback, techniques for making reasoning transparent through chain-of-thought approaches, and validation methods that catch errors before they reach users. These enhancements not only improve immediate user experience but also strengthen your feedback flywheel by creating additional opportunities for collecting insights. By implementing these techniques, you&#39;ll create a RAG system that users genuinely enjoy using—one that explains its reasoning, justifies its answers, and demonstrates reliability through self-correction.
</code></pre></div>
<h2 id="introduction-from-functional-to-exceptional">Introduction: From Functional to Exceptional</h2>
<p>In the previous two chapters, we established critical foundations for successful RAG applications: robust feedback collection mechanisms in Chapter 3.1 and techniques to overcome latency in Chapter 3.2. Now we're ready to elevate our system from merely functional to truly exceptional by addressing the subtle but powerful elements that transform user experience.</p>
<p>Think of a RAG system as similar to a home. The feedback mechanisms are like the foundation—essential but invisible to most visitors. The streaming capabilities are like the utilities—noticed primarily when they're not working well. What we'll cover in this chapter are the finishing touches that visitors actually see and interact with directly: the paint, the furniture, the artwork—the elements that transform a house into a home.</p>
<p>These "quality of life" improvements may seem like optional enhancements, but they often make the difference between systems that are occasionally useful and those that become indispensable tools that users rely on daily. They build trust through transparency, improve reasoning through explicit thinking processes, and prevent errors before they reach users.</p>
<div class="admonition quote">
<p class="admonition-title">Industry Insight</p>
</div>
<p>"These quality of life improvements represent massively missed opportunities for many RAG teams. Implementing chain of thought in ways that matter to your business has been one of the highest-impact changes we've seen, consistently producing a 10% bump in performance. That might not sound dramatic, but it's often the difference between something that's usable and something that's impossible to deploy in production."</p>
<p>In this chapter, we'll explore three categories of improvements:</p>
<ol>
<li><strong>Citations</strong>: How to transform static references into interactive elements that build trust while providing valuable feedback signals</li>
<li><strong>Chain of Thought</strong>: Techniques to make reasoning transparent, improving both accuracy and user confidence</li>
<li><strong>Validation</strong>: Methods to catch errors before they reach users, creating more reliable experiences</li>
</ol>
<p>Each of these approaches not only enhances immediate user experience but also strengthens the feedback flywheel we've been building throughout these chapters. By implementing these techniques, you'll create a RAG system that users not only tolerate but genuinely enjoy using—a system that explains its reasoning, justifies its answers, and catches its own mistakes.</p>
<div class="admonition example">
<p class="admonition-title">Real-world Impact</p>
</div>
<p>One healthcare company implementing the techniques in this chapter saw their user satisfaction scores increase by 34% in just six weeks. More importantly, their user trust metrics—measuring how much users believed and acted on the system's recommendations—increased by 62%. This wasn't just about making users happy; it fundamentally changed how their system influenced real-world decisions.</p>
<h2 id="beyond-the-basics-elevating-user-experience">Beyond the Basics: Elevating User Experience</h2>
<p>When I first started working with RAG systems, I viewed success primarily through the lens of retrieval accuracy and response relevance. If a system could find the right information and generate a coherent answer, I considered it a job well done. But as I gained experience deploying these systems to real users, I realized that truly exceptional RAG applications go beyond these basic capabilities to deliver experiences that build trust, showcase reasoning, and prevent errors before they happen.</p>
<p>In this chapter, we'll explore what I've come to think of as "quality of life improvements"—techniques that transform a technically sound RAG system into a delightful user experience. These approaches don't necessarily improve retrieval or generation in a fundamental way, but they dramatically enhance how users perceive and interact with your system. And as we'll see, many of these techniques create valuable opportunities for additional feedback collection, strengthening the flywheel we established in Chapter 3.1.</p>
<p>After implementing the feedback collection mechanisms from Chapter 3.1 and the streaming techniques from Chapter 3.2, you've already built a solid foundation. Now we'll add the finishing touches that create a truly exceptional experience.</p>
<h2 id="citations-building-trust-through-transparency">Citations: Building Trust Through Transparency</h2>
<h3 id="the-dual-purpose-of-citations">The Dual Purpose of Citations</h3>
<p>When I first started working with RAG systems, I viewed citations as primarily a trust-building mechanism—a way to show users that the system's responses were grounded in actual documents rather than fabricated. While this is certainly valuable, I've come to realize that citations serve an equally important purpose: they're golden opportunities for feedback collection.</p>
<p>Think about it this way. When a user sees a citation in a response, they're naturally curious about the source. By making citations interactive and engaging, you create touchpoints for feedback that feel natural and contextual. This isn't just about slapping a thumbs-up button on your interface; it's about integrating feedback collection into the core user experience.</p>
<p>The most effective approach turns citations from static references into interactive elements that users can engage with:</p>
<ol>
<li>Quote different parts of responses and visually link them to specific citations</li>
<li>Allow users to expand citations to review the full context</li>
<li>Enable users to provide feedback on individual citations</li>
<li>Let users remove irrelevant citations and request regeneration</li>
</ol>
<div class="highlight"><pre><span></span><code>graph TD
    A[Generated Response] --&gt;|Contains| B[Interactive Citations]
    B --&gt;|User Expands| C[Citation Content]
    B --&gt;|User Marks Relevant| D[Positive Training Example]
    B --&gt;|User Marks Irrelevant| E[Negative Training Example]
    B --&gt;|User Removes| F[Regeneration Request]

    style B fill:#f9d77e,stroke:#333,stroke-width:2px
</code></pre></div>
<p>I worked with a legal research team that implemented this approach for their in-house attorneys. Each generated response included interactive citations linked to specific case law or statutes. Attorneys could click on citations to see the full context, and importantly, they could mark citations as relevant or irrelevant to their query. When they marked a citation as irrelevant, the system would regenerate the response without using that source.</p>
<p>This interaction served two purposes: it immediately improved the user experience by removing unhelpful information, and it generated invaluable training data for our retrieval system. Each marked citation became labeled data that helped us fine-tune our embedding models. Within three months, we had collected over 50,000 labeled examples—a dataset that would have been prohibitively expensive to create manually.</p>
<div class="admonition tip">
<p class="admonition-title">Citations as UI Elements</p>
</div>
<p>Design your citations not just as references but as interactive UI elements. When users can explore, evaluate, and modify citations, they become active participants in improving your system rather than passive consumers of information.</p>
<h3 id="crafting-citation-rich-responses">Crafting Citation-Rich Responses</h3>
<p>Creating effective citations begins with how you prompt your language model. Instead of treating citations as an afterthought, build them into your response generation process from the ground up.</p>
<p>Here's a prompt template that encourages detailed, well-structured citations:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_citation_prompt</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">documents</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a prompt that encourages detailed citation usage.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - query: The user&#39;s question</span>
<span class="sd">    - documents: Retrieved documents for context</span>

<span class="sd">    Returns:</span>
<span class="sd">    - A structured prompt that will generate well-cited responses</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Format document context with identifiers</span>
    <span class="n">formatted_docs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">documents</span><span class="p">):</span>
        <span class="n">formatted_docs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DOCUMENT [</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">]: </span><span class="si">{</span><span class="n">doc</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">doc</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">context</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">formatted_docs</span><span class="p">)</span>

    <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    Answer the following question based ONLY on the provided documents.</span>
<span class="s2">    For each piece of information in your answer, include a citation to the specific document it came from using the format [X] where X is the document number.</span>

<span class="s2">    If the documents don&#39;t contain enough information to fully answer the question, say so clearly and cite which documents you used for the partial answer.</span>

<span class="s2">    At the end of your answer, include a &quot;Sources&quot; section that lists all the documents you cited.</span>

<span class="s2">    QUESTION: </span><span class="si">{</span><span class="n">query</span><span class="si">}</span>

<span class="s2">    DOCUMENTS:</span>
<span class="s2">    </span><span class="si">{</span><span class="n">context</span><span class="si">}</span>

<span class="s2">    ANSWER (with citations):</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">prompt</span>
</code></pre></div>
<p>On the frontend, you can transform these citations into interactive elements:</p>
<div class="admonition example">
<p class="admonition-title">Interactive Citations Rendering</p>
</div>
<p><img alt="Example of JavaScript code for rendering interactive citations in responses" src="../../assets/images/interactive-citations-rendering.png" /></p>
<div class="highlight"><pre><span></span><code>*This code demonstrates how to transform a response with citation markers into an interactive UI where citations are clickable elements, and sources can be rated for relevance.*
</code></pre></div>
<p>This creates an interactive experience where citations are visually distinct, clickable elements. When users engage with these elements, you can collect valuable feedback while enhancing their understanding of the response.</p>
<h3 id="advanced-citation-implementation">Advanced Citation Implementation</h3>
<p>Based on extensive office hours discussions, here are production-tested approaches for implementing reliable citations that scale.</p>
<h4 id="xml-based-citation-approach">XML-Based Citation Approach</h4>
<p>The most reliable method for generating accurate citations uses XML tags with chunk IDs and text spans:</p>
<p><strong>Citation Example 1: Wrapping the cited text in XML tags</strong></p>
<div class="highlight"><pre><span></span><code>The study found that accurate citations improve user trust&lt;cit id=&quot;42&quot;&gt;Accurate citations improve user trust&lt;/cit&gt;. Additionally, validating each citation against the source document reduces error rates&lt;cit id=&quot;87&quot;&gt;Validating citations reduces errors&lt;/cit&gt;.
</code></pre></div>
<p><strong>Citation Example 2: XML Including Citation Span</strong></p>
<div class="highlight"><pre><span></span><code>The study found that accurate citations improve user trust&lt;cit id=&quot;42&quot; span=&quot;Accurate citations improve user trust&quot;&gt;Accurate citations improve user trust&lt;/cit&gt;. Additionally, validating each citation against the source document reduces error rates&lt;cit id=&quot;87&quot; span=&quot;Validating citations reduces errors&quot;&gt;Validating citations reduces errors&lt;/cit&gt;.
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Production Insight</p>
</div>
<p>From office hours: "XML-based approaches with chunk IDs and text span references have proven most reliable. Fine-tuning can reduce citation error rates from 4% to nearly 0% with ~10,000 examples." but this is easy to sythnetically generate.</p>
<p><strong>Key Implementation Details:</strong></p>
<ol>
<li><strong>Chunk ID Management</strong>: Assign unique IDs to each document chunk during indexing</li>
<li><strong>Text Span References</strong>: Include exact text spans in citations for verification</li>
<li><strong>Validation Layer</strong>: Verify cited text exists in referenced chunks before displaying</li>
</ol>
<h4 id="fine-tuning-for-citation-accuracy">Fine-Tuning for Citation Accuracy</h4>
<p>Significant improvements come from fine-tuning on citation-specific tasks:</p>
<ul>
<li><strong>Training Data</strong>: Collect ~10,000 examples of correct citations from user feedback</li>
<li><strong>Error Patterns</strong>: Focus on common failure modes (wrong chunk, hallucinated citations)</li>
<li><strong>Validation</strong>: Always validate citations against source documents before display</li>
</ul>
<div class="admonition example">
<p class="admonition-title">Real-World Results</p>
</div>
<p>A healthcare documentation system reduced citation errors from 4% to 0.1% through: - Fine-tuning on 1,200 validated citation examples - XML-based citation format with chunk IDs - Post-generation validation against source documents - Special handling for medical abbreviations</p>
<h4 id="implementation-best-practices">Implementation Best Practices</h4>
<ol>
<li><strong>Citation Format</strong>: Use structured formats that are easy to parse and validate</li>
<li><strong>Source Verification</strong>: Always verify cited content exists in the source</li>
<li><strong>User Feedback Loop</strong>: Make it easy for users to report incorrect citations</li>
<li><strong>Graceful Degradation</strong>: If citation validation fails, show conservative results</li>
</ol>
<p>For detailed implementation examples, see:</p>
<ul>
<li><a href="https://www.anthropic.com/news/constitutional-ai-harmlessness-from-ai-feedback">Anthropic's Constitutional AI approach to citations</a></li>
<li><a href="https://platform.openai.com/docs/guides/prompt-engineering">OpenAI's best practices for reliable citations</a></li>
</ul>
<div class="admonition quote">
<p class="admonition-title">Key Takeaway</p>
</div>
<p>"The combination of XML-based formatting, fine-tuning on domain-specific examples, and post-generation validation creates a citation system users can trust. This trust is essential for deployment in regulated industries like healthcare and legal services."</p>
<h2 id="chain-of-thought-making-thinking-visible">Chain of Thought: Making Thinking Visible</h2>
<h3 id="the-underutilized-superpower">The Underutilized Superpower</h3>
<p>One of the most underutilized yet powerful techniques for improving RAG responses is chain of thought prompting—asking the model to reason step by step before providing its final answer. This approach typically provides a 10% performance improvement for classification and reasoning tasks, which might sound modest until you realize it's often the difference between a system that's occasionally helpful and one that's consistently reliable.</p>
<div class="admonition quote">
<p class="admonition-title">Expert Insight</p>
</div>
<p>"Chain of thought is a massively missed opportunity for many RAG teams. With the advent of models like Claude 3 Opus and GPT-4o, we know this approach is a game-changer for performance. Even without these advanced models, implementing chain of thought in ways that matter to your business has consistently been one of the highest-impact improvements we've seen."</p>
<p>I've found chain of thought particularly valuable for complex retrieval tasks where multiple documents need to be synthesized or where subtle judgments about relevance are required. By making the reasoning explicit, you can identify where things might be going wrong and provide more targeted guidance.</p>
<div class="admonition note">
<p class="admonition-title">Performance Impact</p>
</div>
<p>In our testing across multiple domains, chain of thought prompting consistently improved answer accuracy by 8-15%, with the biggest gains coming in complex reasoning scenarios like multi-hop questions and comparative analyses. This improvement can be the difference between a system that's deployable in production versus one that fails to meet quality thresholds.</p>
<p>When implementing chain of thought, structure it clearly to separate the thinking process from the final response. XML tags work well for this purpose, creating distinct sections that can be processed differently by your application.</p>
<p>Chain of thought also serves another purpose: it can become an engaging loading interstitial. By streaming the reasoning process, you transform waiting time into a transparent window into how the system is working through the problem, building both engagement and trust.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">chain_of_thought_prompt</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">documents</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a prompt that encourages step-by-step reasoning.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - query: The user&#39;s question</span>
<span class="sd">    - documents: Retrieved documents for context</span>

<span class="sd">    Returns:</span>
<span class="sd">    - A prompt that will generate reasoning steps and a final answer</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">context</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;DOCUMENT: </span><span class="si">{</span><span class="n">doc</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">])</span>

    <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    You will answer the user&#39;s question based on the provided documents.</span>
<span class="s2">    First, think step by step about how to answer the question using the documents.</span>
<span class="s2">    Then provide your final answer.</span>

<span class="s2">    Structure your response like this:</span>
<span class="s2">    &lt;thinking&gt;</span>
<span class="s2">    Your step-by-step reasoning process here...</span>
<span class="s2">    &lt;/thinking&gt;</span>

<span class="s2">    &lt;answer&gt;</span>
<span class="s2">    Your final answer here, with citations to specific documents...</span>
<span class="s2">    &lt;/answer&gt;</span>

<span class="s2">    USER QUESTION: </span><span class="si">{</span><span class="n">query</span><span class="si">}</span>

<span class="s2">    DOCUMENTS:</span>
<span class="s2">    </span><span class="si">{</span><span class="n">context</span><span class="si">}</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">prompt</span>
</code></pre></div>
<p>Taking this a step further, you can stream the thinking process as a separate UI component or interstitial. This serves two purposes: it makes the waiting time more engaging by showing users that complex reasoning is happening, and it allows users to intervene if they notice the reasoning going astray.</p>
<div class="admonition example">
<p class="admonition-title">Chain of Thought Streaming Implementation</p>
</div>
<p><img alt="Example of JavaScript code for processing and displaying streamed chain of thought" src="../../assets/images/chain-of-thought-streaming.png" /></p>
<div class="highlight"><pre><span></span><code>*This code processes streamed tokens containing XML-tagged thinking and answer sections, rendering them in separate UI components. This makes the reasoning process transparent and engaging for users.*
</code></pre></div>
<p>I worked with a financial advisory firm that implemented this approach for their investment recommendation system. As the model reasoned through market conditions, client preferences, and portfolio considerations, this thinking was streamed to the advisor in a separate panel. If the advisor noticed a misunderstanding or faulty assumption in the reasoning, they could pause generation and refine their query before a final recommendation was produced.</p>
<p>This interactive approach not only improved recommendation quality but also created a valuable feedback loop where advisors could correct misunderstandings early in the process. Each correction became training data that helped the system learn and improve over time.</p>
<p>On the frontend, you can implement this with an expandable "See reasoning" section that users can toggle to view the model's step-by-step analysis. This transparency builds trust by demystifying the AI process and gives users insight into how conclusions were reached.</p>
<p>The beauty of chain of thought isn't just that it improves immediate response quality—it also creates a more explainable, trustworthy system that users feel comfortable relying on. In domains where decisions matter and consequences are real, this transparency can be the difference between a system that's used occasionally and one that becomes an indispensable tool.</p>
<h2 id="monologues-solving-the-context-management-problem">Monologues: Solving the Context Management Problem</h2>
<h3 id="reasoning-in-limited-windows">Reasoning in Limited Windows</h3>
<p>As context windows grow larger, one might think that managing complex information would become easier. Counterintuitively, though, larger context windows often create new challenges for language models, which can struggle to attend to the most relevant information among thousands of tokens.</p>
<p>Monologuing—having the model explicitly reiterate key information before generating a response—has emerged as a powerful technique to enhance reasoning and quality, especially with large contexts and complex documents.</p>
<div class="admonition example">
<p class="admonition-title">Key Insight</p>
</div>
<p>When dealing with very long contexts, language models often struggle with recall and fully processing all instructions. By having the model monologue - explicitly reiterate key information before answering - we reorganize the context in a way that allows the model to effectively "re-read" the prompt, improving reasoning dramatically without complex architectural changes.</p>
<p>The process is wonderfully simple: ask the model to "think out loud" about what information is relevant before generating the final answer. This serves several purposes:</p>
<ol>
<li>It helps the model re-read and reinforce important context</li>
<li>It allows the model to organize scattered information into a coherent structure</li>
<li>It creates natural separation between reasoning and response</li>
<li>It produces valuable data for future fine-tuning</li>
<li>It can replace more complex multi-stage agents for many use cases</li>
<li>It can improve consistency by ensuring the model considers all relevant factors</li>
</ol>
<p>Monologues have proven particularly effective at replacing complex agent architectures for many use cases. Rather than building intricate multi-stage processes, you can often achieve similar results with a single thoughtfully constructed monologue prompt, saving both development time and computational resources.</p>
<p>Here's an example prompt for implementing monologues:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">monologue_prompt</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">documents</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">pricing_data</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a prompt that encourages monologuing for improved comprehension.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - query: The user&#39;s question about pricing options</span>
<span class="sd">    - documents: Relevant call transcripts or customer information</span>
<span class="sd">    - pricing_data: Pricing documentation and guidelines</span>

<span class="sd">    Returns:</span>
<span class="sd">    - A prompt that will generate a structured monologue before answering</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">context</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;TRANSCRIPT: </span><span class="si">{</span><span class="n">doc</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">])</span>

    <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    You&#39;ll help generate a pricing quote based on the call transcript and pricing documentation.</span>

<span class="s2">    First, reiterate the key variables that determine pricing options according to the documentation.</span>
<span class="s2">    Then, identify specific parts of the transcript that relate to these variables.</span>
<span class="s2">    Next, determine which pricing options from the documentation are most relevant.</span>
<span class="s2">    Finally, provide a recommended pricing quote with justification.</span>

<span class="s2">    QUESTION: </span><span class="si">{</span><span class="n">query</span><span class="si">}</span>

<span class="s2">    TRANSCRIPT:</span>
<span class="s2">    </span><span class="si">{</span><span class="n">context</span><span class="si">}</span>

<span class="s2">    PRICING DOCUMENTATION:</span>
<span class="s2">    </span><span class="si">{</span><span class="n">pricing_data</span><span class="si">}</span>

<span class="s2">    MONOLOGUE AND ANSWER:</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">prompt</span>
</code></pre></div>
<p>I want to share a specific case study that demonstrates the power of monologues. We were working with a SaaS company that needed to generate pricing quotes based on sales call transcripts and a complex pricing document. The initial approach—simply providing the transcript and pricing document as context—resulted in quotes that were often inconsistent or missed key information from the transcript.</p>
<div class="admonition example">
<p class="admonition-title">Monologue Implementation</p>
</div>
<p>Rather than building a complex multi-stage agent, we found it was much more effective to simply cache-prompt the pricing data and inject a single call transcript with specific monologue instructions.</p>
<p>We implemented a monologue-based approach that instructed the model to:</p>
<ol>
<li>First reiterate the variables that determine pricing options</li>
<li>Then identify relevant parts of the transcript that mention these variables</li>
<li>Next determine which pricing tiers and options apply</li>
<li>Finally generate the actual quote with justification</li>
</ol>
<p>The results were remarkable—quote accuracy improved from 62% to 94%, and sales representatives reported much greater confidence in the system's recommendations. The monologue approach helped the model connect scattered information from the transcript with the precise rules in the pricing document, creating much more coherent reasoning.</p>
<div class="admonition success">
<p class="admonition-title">Business Impact</p>
</div>
<p>After implementing this approach, 90% of the follow-up emails were accepted by sales reps without any edits. This generated a wealth of training data that we used to fine-tune a smaller, more efficient model. Eventually, the fine-tuned model achieved similar accuracy without needing the explicit monologue step, demonstrating how monologues can be used as a stepping stone to more efficient solutions.</p>
<div class="admonition example">
<p class="admonition-title">Monologue in Action</p>
</div>
<p><strong>Query:</strong> What pricing should we offer based on this call transcript?</p>
<div class="highlight"><pre><span></span><code>**Monologue:**
Let me identify the key pricing variables from our documentation:
1. Number of users (determines tier)
2. Required features (basic, professional, enterprise)
3. Length of contract commitment (monthly vs. annual)
4. Add-on options (API access, premium support)

From the transcript, I can see:
- The customer mentioned needing &quot;around 50 user seats&quot; (line 127)
- They specifically asked about the &quot;workflow automation feature&quot; (line 213)
- They stated &quot;we&#39;re looking for an annual commitment&quot; (line 289)
- They expressed interest in &quot;API access for integration&quot; (line 342)

According to our pricing documentation:
- 50 users falls into the Medium Business tier ($30/user/month)
- Workflow automation is part of the Professional plan
- Annual commitment provides a 20% discount
- API access is a $500/month add-on

**Answer:**
Based on the call transcript, I recommend offering the Professional plan with API access add-on:
- 50 users × $30/user/month = $1,500/month
- API access add-on: $500/month
- Subtotal: $2,000/month
- Annual commitment (20% discount): $19,200/year

This aligns with their needs for workflow automation and API access while providing the annual discount they&#39;re expecting.
</code></pre></div>
<p>This example shows how monologues can dramatically improve comprehension and reasoning, especially for complex tasks with multiple documents. The approach doesn't require any special architecture—just thoughtful prompting that encourages the model to organize information before generating a response.</p>
<p>Monologues can also improve tonality and quality by separating reasoning from response generation. Have the model first reason about what to say, then say it in the desired tone. This creates datasets for future fine-tuning without reasoning steps, allowing you to eventually distill the reasoning process into more efficient models.</p>
<h2 id="validation-patterns-the-safety-net-approach">Validation Patterns: The Safety Net Approach</h2>
<h3 id="catching-errors-before-they-reach-users">Catching Errors Before They Reach Users</h3>
<p>In the early days of RAG systems, there was a tendency to treat the language model's response as the final word—whatever it generated went straight to the user, for better or worse. As these systems have evolved and stakes have increased, we've learned the value of adding validation layers that catch issues before they reach users.</p>
<div class="admonition quote">
<p class="admonition-title">Industry Perspective</p>
</div>
<p>"As language models get more sophisticated, we're finding that a single well-designed prompt combined with simple validation often outperforms complex multi-stage agent behaviors. I recommend implementing validation patterns before building elaborate agent architectures - they're simpler to deploy, easier to debug, and frequently just as effective."</p>
<p>Think of validation patterns as safety nets for your RAG system. Just as a circus performer feels more confident with a net below, your system can be more ambitious knowing that validation checks will catch potential errors.</p>
<p>Before implementing complex agent systems or multi-step pipelines, consider adding simple validation patterns to your RAG application. For latency-insensitive applications—where an extra second or two of processing won't harm the user experience—validators can significantly increase trust and satisfaction by ensuring responses meet quality standards.</p>
<div class="admonition tip">
<p class="admonition-title">When to Use Validators</p>
</div>
<p>Validators are particularly valuable in:</p>
<div class="highlight"><pre><span></span><code>1. High-stakes domains where errors could have significant consequences
2. Applications where users make important decisions based on system output
3. Scenarios where specific constraints must be enforced (like valid URLs or specific data formats)
4. Cases where you need to increase user trust in system outputs

The slight latency increase is often well worth the improved reliability and user confidence.
</code></pre></div>
<div class="highlight"><pre><span></span><code>sequenceDiagram
    participant User
    participant RAG as RAG System
    participant Validator

    User-&gt;&gt;RAG: Submits Query
    RAG-&gt;&gt;RAG: Retrieves Documents
    RAG-&gt;&gt;RAG: Generates Response
    RAG-&gt;&gt;Validator: Submits Response for Validation

    alt Response Passes Validation
        Validator-&gt;&gt;RAG: Approves Response
        RAG-&gt;&gt;User: Delivers Validated Response
    else Response Fails Validation
        Validator-&gt;&gt;RAG: Returns Specific Issues
        RAG-&gt;&gt;RAG: Regenerates Response
        RAG-&gt;&gt;Validator: Submits Revised Response
        Validator-&gt;&gt;RAG: Approves Response
        RAG-&gt;&gt;User: Delivers Validated Response
    end
</code></pre></div>
<p>Validators act as a quality control layer that checks responses before they reach the user. The process is straightforward:</p>
<ol>
<li>Generate your reasoning, citations, and response as usual</li>
<li>Pass the results to a secondary system (LLM or simple programmatic tests)</li>
<li>Evaluate whether the response meets quality criteria</li>
<li>If issues are found, provide specific feedback and regenerate</li>
</ol>
<p>I worked with a healthcare information provider that implemented a simple factual consistency validator for their patient-facing RAG system. After generating a response about treatment options, the validator would check whether all mentioned treatments were actually present in the retrieved documents and whether any contraindications or warnings had been omitted. If discrepancies were found, the response would be regenerated with specific instructions to correct the issues.</p>
<p>This approach reduced factual errors by over 80% with minimal impact on latency—a trade-off well worth making given the sensitive nature of healthcare information. The validator wasn't complex or expensive to implement, but it dramatically improved reliability and trustworthiness.</p>
<h3 id="a-practical-example-url-validation">A Practical Example: URL Validation</h3>
<p>Let me share a concrete example that illustrates the power of simple validators. I worked with a marketing team building a system to generate personalized follow-up emails that included links to case studies and marketing materials. The language model was excellent at crafting personalized messages, but we encountered a persistent problem: about 4% of generated emails contained URLs that either didn't exist or linked to internal resources that weren't publicly accessible.</p>
<p>Rather than scrapping the approach or implementing a complex agent system, we added a straightforward validator that ran after response generation:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_urls_in_email</span><span class="p">(</span><span class="n">email_body</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">allowed_domains</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate that all URLs in an email are valid and from allowed domains.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - email_body: The generated email content</span>
<span class="sd">    - allowed_domains: List of allowed domains for links</span>

<span class="sd">    Returns:</span>
<span class="sd">    - (is_valid, issues): Tuple of validation result and list of issues</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Extract all URLs using regex</span>
    <span class="n">url_regex</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;https?://(?:[-\w.]|(?:%[\da-fA-F]</span><span class="si">{2}</span><span class="s1">))+&#39;</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">url_regex</span><span class="p">,</span> <span class="n">email_body</span><span class="p">)</span>

    <span class="n">issues</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Check each URL</span>
    <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
        <span class="c1"># Check if the domain is allowed</span>
        <span class="n">domain</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">netloc</span>
        <span class="k">if</span> <span class="n">domain</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allowed_domains</span><span class="p">:</span>
            <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;URL </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2"> contains disallowed domain </span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="c1"># Check if the URL exists (returns 200)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
                <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;URL </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2"> returned status code </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;URL </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2"> failed to connect: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">issues</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">issues</span>

<span class="k">def</span><span class="w"> </span><span class="nf">regenerate_email_if_needed</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">initial_email</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">allowed_domains</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate and potentially regenerate an email if URLs are problematic.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">is_valid</span><span class="p">,</span> <span class="n">issues</span> <span class="o">=</span> <span class="n">validate_urls_in_email</span><span class="p">(</span><span class="n">initial_email</span><span class="p">,</span> <span class="n">allowed_domains</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">is_valid</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">initial_email</span>

    <span class="c1"># If validation failed, regenerate with specific guidance</span>
    <span class="n">issues_text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">issues</span><span class="p">)</span>
    <span class="n">regeneration_prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    The previously generated email contained the following URL issues:</span>
<span class="s2">    </span><span class="si">{</span><span class="n">issues_text</span><span class="si">}</span>

<span class="s2">    Please regenerate the email, either:</span>
<span class="s2">    1. Removing any problematic URLs entirely, or</span>
<span class="s2">    2. Replacing them with valid URLs from these domains: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">allowed_domains</span><span class="p">)</span><span class="si">}</span>

<span class="s2">    Original request: </span><span class="si">{</span><span class="n">query</span><span class="si">}</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">regenerated_email</span> <span class="o">=</span> <span class="n">generate_email</span><span class="p">(</span><span class="n">regeneration_prompt</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">regenerated_email</span>
</code></pre></div>
<p>The results were remarkable. After implementing this validator, the error rate dropped from 4% to 0% after just one retry.</p>
<div class="admonition success">
<p class="admonition-title">Beyond Validation: Fine-tuning from Corrections</p>
</div>
<p>Even more interestingly, we took the validation process a step further. After collecting sufficient examples of corrections, we fine-tuned our model (distilling GPT-4 into a smaller model) using this dataset of corrected responses. The result was astonishing - the base error rate before validation dropped to nearly zero. The model had effectively learned from its corrections, internalizing the patterns of valid URLs and avoiding problematic ones altogether.</p>
<div class="highlight"><pre><span></span><code>This entire validation and fine-tuning process took just three days to implement and resulted in a much faster application since we no longer needed the retry loop. The model now produces valid URLs in a single pass.
</code></pre></div>
<p>This example illustrates a broader principle: validation doesn't just catch errors—it creates valuable training data that can improve your system over time. Each correction becomes a learning opportunity, gradually reducing the need for the validator itself.</p>
<div class="admonition warning">
<p class="admonition-title">Persistent Challenges</p>
</div>
<p>It's worth noting that even in early 2025, even the most advanced models can still produce hallucinated URLs when given the opportunity. Simple validators remain valuable safeguards even as models continue to improve.</p>
<h2 id="strategic-rejection-of-work">Strategic Rejection of Work</h2>
<h3 id="when-i-dont-know-is-the-right-answer">When "I Don't Know" is the Right Answer</h3>
<p>One of the most overlooked strategies for improving RAG application reliability is knowing when to reject work. Rather than delaying deployment until all edge cases are solved, implement strategic rejection for scenarios where your system isn't yet strong enough. This allows you to deploy sooner while collecting data to improve problematic segments.</p>
<div class="admonition quote">
<p class="admonition-title">Industry Insight</p>
</div>
<p>"One of the things you'll realize as you analyze your RAG system's performance is that oftentimes you can make your application much more reliable just by rejecting certain types of work. This is a massively underutilized strategy - many teams try to handle every query thrown at them rather than focusing on what they can reliably deliver."</p>
<p>The approach is simple but powerful:</p>
<ol>
<li>Identify segments where performance is consistently poor</li>
<li>Create rejection messages that set appropriate expectations</li>
<li>Provide feedback forms to gather information about rejected queries</li>
<li>Give users the option to proceed with caution if they wish</li>
</ol>
<p>This pattern works particularly well for specialized domains where some questions might require expertise your system hasn't yet developed. By acknowledging limitations transparently, you build trust while focusing on the areas where you can deliver value reliably.</p>
<div class="admonition example">
<p class="admonition-title">Rejection in Practice</p>
</div>
<p>One enterprise RAG application we built for legal research would explicitly reject certain types of complex regulatory analysis questions with a message like:</p>
<div class="highlight"><pre><span></span><code>&quot;I notice you&#39;re asking about cross-jurisdictional implications of regulation X. Currently, I&#39;m not confident in my ability to analyze multi-jurisdictional regulatory conflicts accurately. Would you like me to instead focus on the requirements within your primary jurisdiction, or connect you with a regulatory specialist?&quot;

This approach was far better received than attempting answers that might contain subtle but critical errors.
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">should_reject_query</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">confidence_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.85</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine if a query should be politely rejected.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - query: The user&#39;s question</span>
<span class="sd">    - confidence_threshold: Minimum confidence to accept the query</span>

<span class="sd">    Returns:</span>
<span class="sd">    - (should_reject, reason): Whether to reject and why</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Analyze the query</span>
    <span class="n">query_category</span> <span class="o">=</span> <span class="n">classify_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
    <span class="n">query_complexity</span> <span class="o">=</span> <span class="n">assess_complexity</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
    <span class="n">expected_confidence</span> <span class="o">=</span> <span class="n">predict_confidence</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">query_category</span><span class="p">,</span> <span class="n">query_complexity</span><span class="p">)</span>

    <span class="c1"># Check against thresholds</span>
    <span class="k">if</span> <span class="n">expected_confidence</span> <span class="o">&lt;</span> <span class="n">confidence_threshold</span><span class="p">:</span>
        <span class="n">reason</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;This appears to be a </span><span class="si">{</span><span class="n">query_category</span><span class="si">}</span><span class="s2"> question with </span><span class="si">{</span><span class="n">query_complexity</span><span class="si">}</span><span class="s2"> complexity. &quot;</span> \
                 <span class="sa">f</span><span class="s2">&quot;Based on similar questions, our confidence is </span><span class="si">{</span><span class="n">expected_confidence</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span> \
                 <span class="sa">f</span><span class="s2">&quot;which is below our threshold of </span><span class="si">{</span><span class="n">confidence_threshold</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">reason</span>

    <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>

<span class="k">def</span><span class="w"> </span><span class="nf">handle_query_with_rejection</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Process a query with potential rejection if the system isn&#39;t confident.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">should_reject</span><span class="p">,</span> <span class="n">reason</span> <span class="o">=</span> <span class="n">should_reject_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">should_reject</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;rejection&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;I&#39;m not confident I can answer this question accurately. </span><span class="si">{</span><span class="n">reason</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;allow_override&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;feedback_requested&quot;</span><span class="p">:</span> <span class="kc">True</span>
        <span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Process normally</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="n">retrieve_documents</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">generate_response</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">documents</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;answer&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">response</span>
        <span class="p">}</span>
</code></pre></div>
<p>Design your rejection system with precision-recall tradeoffs in mind - avoid rejecting questions you can actually answer well. The rejection should always be polite, explain the limitation, and where possible, suggest alternative approaches or questions the system can handle.</p>
<h2 id="showcasing-capabilities">Showcasing Capabilities</h2>
<h3 id="guide-users-to-what-you-do-well">Guide Users to What You Do Well</h3>
<p>While RAG systems can theoretically answer a wide range of questions, most excel at particular types of queries. Explicitly highlighting what your system does well guides user behavior toward successful interactions.</p>
<div class="admonition quote">
<p class="admonition-title">UX Design Insight</p>
</div>
<p>"Not all prompting should be for the language model - we should also prompt the user. People are generally lazy and often don't know exactly what they want. By giving them examples early on, you make their lives easier while showcasing capabilities they might not have known were possible."</p>
<p>Implement these strategies to showcase your system's strengths:</p>
<ul>
<li>Show suggested query types that leverage your strengths</li>
<li>Create UI elements that highlight special capabilities</li>
<li>Provide examples of successful interactions</li>
<li>Use white space to create different blocks showcasing specialized capabilities</li>
</ul>
<p>Perplexity provides an excellent example of this approach. Their interface showcases different capabilities (web search, academic papers, math equations) with specific UI elements, guiding users toward interactions that will be successful.</p>
<div class="admonition example">
<p class="admonition-title">Capability Demonstration</p>
</div>
<p>When Perplexity added their "Social" search capability, many users didn't even know this was possible. By prominently featuring this option in the interface, they not only educated users about a new capability but also increased engagement with a feature they wanted to promote.</p>
<p>By highlighting certain capabilities, you not only improve user satisfaction by focusing on strengths, but you also set appropriate expectations about what the system doesn't handle well. This creates a more predictable experience where users know what to expect.</p>
<p>This approach also complements the strategic rejection strategy - when users are guided toward your strengths, they're less likely to attempt queries that would trigger rejection responses.</p>
<h2 id="putting-it-all-together-the-complete-experience">Putting It All Together: The Complete Experience</h2>
<p>When implemented together, these quality of life improvements create a comprehensive, trustworthy experience that elevates your RAG application above typical implementations:</p>
<ol>
<li><strong>Streaming</strong> creates an engaging, responsive experience that keeps users engaged</li>
<li><strong>Citations</strong> build trust and provide opportunities for feedback collection</li>
<li><strong>Chain of thought</strong> makes reasoning transparent and improves accuracy</li>
<li><strong>Monologues</strong> enhance comprehension of complex information</li>
<li><strong>Validation</strong> catches errors before they reach users</li>
<li><strong>Strategic rejection</strong> sets appropriate expectations</li>
<li><strong>Capability showcasing</strong> guides users to successful interactions</li>
</ol>
<p>Each element reinforces the others, creating a system that feels polished, trustworthy, and genuinely helpful. Users don't just get answers—they understand where those answers come from, see the reasoning behind them, and trust that they've been validated for accuracy.</p>
<h2 id="preparing-for-the-next-chapter">Preparing for the Next Chapter</h2>
<p>With these quality of life improvements in place, your RAG system now provides an exceptional user experience that builds trust, encourages engagement, and generates valuable feedback. In the next chapter, we'll explore how to make sense of all the data you're collecting through topic modeling and clustering techniques. These approaches will help you identify patterns in user queries and system performance, revealing the highest-impact opportunities for improvement.</p>
<h2 id="conclusion-the-complete-rag-experience">Conclusion: The Complete RAG Experience</h2>
<p>Throughout this chapter, we've explored techniques that transform a technically sound RAG system into an exceptional user experience. Let's recap the key principles we've covered:</p>
<ol>
<li>
<p><strong>Interactive citations build trust and collect feedback</strong> - By making citations explorable and interactive, you simultaneously build confidence and gather valuable training signals, allowing users to delete irrelevant citations and regenerate better answers.</p>
</li>
<li>
<p><strong>Chain of thought reasoning improves accuracy and transparency</strong> - Making thinking visible not only leads to better answers (with a consistent 10% performance improvement) but also helps users understand how conclusions were reached, building trust in the system's outputs.</p>
</li>
<li>
<p><strong>Monologues enhance comprehension of complex information</strong> - Encouraging the model to organize and reiterate key information improves reasoning in complex contexts without requiring elaborate multi-stage agent architectures.</p>
</li>
<li>
<p><strong>Validation patterns catch errors before they reach users</strong> - Simple validation checks dramatically improve reliability, creating both immediate value and generating training data that can improve base model performance over time.</p>
</li>
<li>
<p><strong>Strategic rejection sets appropriate expectations</strong> - Being transparent about limitations builds trust while collecting data for future improvements, making your system more reliable by focusing on what it can do well.</p>
</li>
<li>
<p><strong>Capability showcasing guides users effectively</strong> - Explicitly highlighting your system's strengths improves user satisfaction and engagement while setting appropriate expectations.</p>
</li>
</ol>
<div class="admonition quote">
<p class="admonition-title">Practical Implementation Strategy</p>
</div>
<p>"When implementing these improvements, I recommend starting with citations and validation patterns, as they provide the most immediate reliability gains. Then add chain of thought for complex reasoning scenarios, followed by strategic rejection for edge cases. These foundational elements will deliver the most value for your development time while setting the stage for more advanced techniques."</p>
<p>These improvements work in concert with the feedback mechanisms from Chapter 3.1 and the streaming techniques from Chapter 3.2 to create a comprehensive, user-centered RAG experience. Each element reinforces the others: citations provide opportunities for feedback, streaming makes the thinking process engaging, and validation ensures that what users see is reliable.</p>
<p>This completes our exploration of deployment and feedback collection. We've now built a robust system that not only delivers accurate information but does so in a way that users find trustworthy, engaging, and helpful. The system collects feedback naturally, feels responsive despite complex processing, and provides transparency into its reasoning and sources.</p>
<p>In Chapter 4, we'll shift our focus to analyzing the wealth of data you're now collecting. Through topic modeling and clustering techniques, you'll learn to identify patterns in user queries and system performance, revealing focused opportunities for improvement. This marks an exciting transition from building a great system to understanding how it's being used in the real world and systematically enhancing its capabilities based on that understanding.</p>
<p>By implementing the techniques from all three parts of Chapter 3, you've built the foundation for a continuous improvement cycle driven by user feedback and data analysis—a system that doesn't just answer questions but gets better with every interaction.</p>







  
  



  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../chapter3-2/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Feedback Collection">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Feedback Collection
              </div>
            </div>
          </a>
        
        
          
          <a href="../chapter4-1/" class="md-footer__link md-footer__link--next" aria-label="Next: Analysis">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Analysis
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://x.com/jxnlco" target="_blank" rel="noopener" title="x.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["announce.dismiss", "navigation.instant", "navigation.tracking", "navigation.expand", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.footer", "search.highlight", "search.share", "search.suggest", "toc.follow", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
    
  </body>
</html>