
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Learn practical implementation techniques for documents, images, tables, and SQL generation" name="description"/>
<link href="https://567-labs.github.io/systematically-improving-rag/workshops/chapter5-2/" rel="canonical"/>
<link href="../chapter5-1/" rel="prev"/>
<link href="../chapter6-1/" rel="next"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.14" name="generator"/>
<title>Implementing Multimodal Search - Systematically Improving RAG Applications</title>
<link href="../../assets/stylesheets/main.342714a4.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../stylesheets/extra.css" rel="stylesheet"/>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config",""),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
<script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
<link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></link></head>
<body data-md-color-accent="black" data-md-color-primary="black" data-md-color-scheme="slate" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#implementing-multimodal-search-specialized-retrieval-techniques">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
<aside class="md-banner">
<div class="md-banner__inner md-grid md-typeset">
<button aria-label="Don't show this again" class="md-banner__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
<p>
    This material is supported by <a href="https://maven.com/applied-llms/rag-playbook?promoCode=EBOOK" target="_blank"><strong>Applied LLMs on Maven</strong></a>.  Readers get 20% off.
    Not ready? Check out the <a href="https://fivesixseven.ck.page/rag-crash-course" target="_blank"><strong>free email course</strong></a>.
  </p>
</div>
<script>var el=document.querySelector("[data-md-component=announce]");if(el){var content=el.querySelector(".md-typeset");__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0)}</script>
</aside>
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Systematically Improving RAG Applications" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Systematically Improving RAG Applications">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Systematically Improving RAG Applications
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Implementing Multimodal Search
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="black" data-md-color-media="" data-md-color-primary="black" data-md-color-scheme="slate" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"></path></svg>
</label>
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<a aria-label="Share" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="Share">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg>
</a>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../..">
        
  
  
    
  
  Home

      </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../">
          
  
  
    
  
  Workshops

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../office-hours/">
        
  
  
    
  
  Office Hours

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../talks/">
          
  
  
    
  
  Talks

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../misc/learning-goals/">
          
  
  
    
  
  Resources

        </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Systematically Improving RAG Applications" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Systematically Improving RAG Applications">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    Systematically Improving RAG Applications
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    Home
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../">
<span class="md-ellipsis">
    Workshops
    
  </span>
</a>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Workshops
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../chapter0/">
<span class="md-ellipsis">
    Introduction
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="">
<span class="md-ellipsis">
    Chapter 1: Starting the Flywheel
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_3">
<span class="md-nav__icon md-icon"></span>
            Chapter 1: Starting the Flywheel
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../chapter1/">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="">
<span class="md-ellipsis">
    Chapter 2: From Evaluation to Enhancement
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_4">
<span class="md-nav__icon md-icon"></span>
            Chapter 2: From Evaluation to Enhancement
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../chapter2/">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="">
<span class="md-ellipsis">
    Chapter 3: User Experience
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_5_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_5">
<span class="md-nav__icon md-icon"></span>
            Chapter 3: User Experience
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../chapter3-1/">
<span class="md-ellipsis">
    Design Principles
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../chapter3-2/">
<span class="md-ellipsis">
    Feedback Collection
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../chapter3-3/">
<span class="md-ellipsis">
    Iterative Improvement
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="">
<span class="md-ellipsis">
    Chapter 4: Topic Modeling
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_6_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_6">
<span class="md-nav__icon md-icon"></span>
            Chapter 4: Topic Modeling
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../chapter4-1/">
<span class="md-ellipsis">
    Analysis
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../chapter4-2/">
<span class="md-ellipsis">
    Prioritization
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_2_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_7" id="__nav_2_7_label" tabindex="">
<span class="md-ellipsis">
    Chapter 5: Multimodal Capabilities
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_2_7_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_7">
<span class="md-nav__icon md-icon"></span>
            Chapter 5: Multimodal Capabilities
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../chapter5-1/">
<span class="md-ellipsis">
    Understanding
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    Implementation
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    Implementation
    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#specialized-approaches-for-different-modalities">
<span class="md-ellipsis">
      Specialized Approaches for Different Modalities
    </span>
</a>
<nav aria-label="Specialized Approaches for Different Modalities" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#document-search-beyond-basic-chunking">
<span class="md-ellipsis">
      Document Search: Beyond Basic Chunking
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#image-search-bridging-visual-and-textual-understanding">
<span class="md-ellipsis">
      Image Search: Bridging Visual and Textual Understanding
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#table-search-structured-data-in-context">
<span class="md-ellipsis">
      Table Search: Structured Data in Context
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#sql-query-generation-a-case-study-in-capability-building">
<span class="md-ellipsis">
      SQL Query Generation: A Case Study in Capability Building
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#bringing-it-all-together">
<span class="md-ellipsis">
      Bringing It All Together
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_8" id="__nav_2_8_label" tabindex="">
<span class="md-ellipsis">
    Chapter 6: Architecture
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_8_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_8">
<span class="md-nav__icon md-icon"></span>
            Chapter 6: Architecture
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../chapter6-1/">
<span class="md-ellipsis">
    Routing
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../chapter6-2/">
<span class="md-ellipsis">
    Tools
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../chapter6-3/">
<span class="md-ellipsis">
    Improvement
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../office-hours/">
<span class="md-ellipsis">
    Office Hours
    
  </span>
</a>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            Office Hours
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../office-hours/faq/">
<span class="md-ellipsis">
    FAQ
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../office-hours/AGENTS/">
<span class="md-ellipsis">
    Agents
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_3_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
<span class="md-ellipsis">
    Chapter 1: Starting the Flywheel
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_3">
<span class="md-nav__icon md-icon"></span>
            Chapter 1: Starting the Flywheel
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../office-hours/cohort2/week1-summary/">
<span class="md-ellipsis">
    Cohort 2 - Week 1
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../office-hours/cohort3/week-1-1/">
<span class="md-ellipsis">
    Cohort 3 - Session 1
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../office-hours/cohort3/week-1-2/">
<span class="md-ellipsis">
    Cohort 3 - Session 2
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_3_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
<span class="md-ellipsis">
    Chapter 2: From Evaluation to Enhancement
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_4">
<span class="md-nav__icon md-icon"></span>
            Chapter 2: From Evaluation to Enhancement
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../office-hours/cohort2/week2-summary/">
<span class="md-ellipsis">
    Cohort 2 - Week 2
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../office-hours/cohort3/week-2-1/">
<span class="md-ellipsis">
    Cohort 3 - Session 1
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../office-hours/cohort3/week-2-2/">
<span class="md-ellipsis">
    Cohort 3 - Session 2
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_3_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
<span class="md-ellipsis">
    Chapter 3: User Experience
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_5_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_5">
<span class="md-nav__icon md-icon"></span>
            Chapter 3: User Experience
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../office-hours/cohort2/week3-summary/">
<span class="md-ellipsis">
    Cohort 2 - Week 3
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../office-hours/cohort3/week-3-1/">
<span class="md-ellipsis">
    Cohort 3 - Session 1
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_3_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
<span class="md-ellipsis">
    Chapter 4: Topic Modeling
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_6_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_6">
<span class="md-nav__icon md-icon"></span>
            Chapter 4: Topic Modeling
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../office-hours/cohort2/week4-summary/">
<span class="md-ellipsis">
    Cohort 2 - Week 4
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../office-hours/cohort3/week-4-1/">
<span class="md-ellipsis">
    Cohort 3 - Session 1
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../office-hours/cohort3/week-4-2/">
<span class="md-ellipsis">
    Cohort 3 - Session 2
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_3_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
<span class="md-ellipsis">
    Chapter 5: Multimodal Capabilities
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_7_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_7">
<span class="md-nav__icon md-icon"></span>
            Chapter 5: Multimodal Capabilities
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../office-hours/cohort2/week5-summary/">
<span class="md-ellipsis">
    Cohort 2 - Week 5
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../office-hours/cohort3/week-5-1/">
<span class="md-ellipsis">
    Cohort 3 - Session 1
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../office-hours/cohort3/week-5-2/">
<span class="md-ellipsis">
    Cohort 3 - Session 2
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_3_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_8" id="__nav_3_8_label" tabindex="0">
<span class="md-ellipsis">
    Chapter 6: Architecture
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_8_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_8">
<span class="md-nav__icon md-icon"></span>
            Chapter 6: Architecture
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../office-hours/cohort2/week6-summary/">
<span class="md-ellipsis">
    Cohort 2 - Week 6
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../talks/">
<span class="md-ellipsis">
    Talks
    
  </span>
</a>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Talks
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
<span class="md-ellipsis">
    Search / Indexing / Chunking
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_2">
<span class="md-nav__icon md-icon"></span>
            Search / Indexing / Chunking
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../talks/chromadb-anton-chunking/">
<span class="md-ellipsis">
    Text Chunking Strategies (Anton, ChromaDB)
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../talks/john-lexical-search/">
<span class="md-ellipsis">
    Lexical Search in RAG Applications (John Berryman)
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../talks/query-routing-anton/">
<span class="md-ellipsis">
    Query Routing for RAG Systems (Anton, ChromaDB)
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../talks/semantic-search-exa-will-bryk/">
<span class="md-ellipsis">
    Semantic Search Over the Web with Exa (Will Bryk, Exa)
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../talks/rag-without-apis-browser-michael-struwig/">
<span class="md-ellipsis">
    RAG Without APIs: Browser-Based Retrieval (Michael, OpenBB)
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
<span class="md-ellipsis">
    Finetuning
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_3">
<span class="md-nav__icon md-icon"></span>
            Finetuning
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../talks/glean-manav/">
<span class="md-ellipsis">
    Enterprise Search and Fine-tuning Embedding Models (Manav, Glean)
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../talks/fine-tuning-rerankers-embeddings-ayush-lancedb/">
<span class="md-ellipsis">
    Fine-tuning Re-rankers and Embedding Models (Ayush, LanceDB)
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../talks/embedding-performance-generative-evals-kelly-hong/">
<span class="md-ellipsis">
    Understanding Embedding Performance through Generative Evals (Kelly Hong)
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
<span class="md-ellipsis">
    Monitoring
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_4">
<span class="md-nav__icon md-icon"></span>
            Monitoring
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../talks/online-evals-production-monitoring-ben-sidhant/">
<span class="md-ellipsis">
    Online Evals and Production Monitoring (Ben &amp; Sidhant)
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../talks/rag-antipatterns-skylar-payne/">
<span class="md-ellipsis">
    RAG Anti-patterns in the Wild (Skylar Payne)
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../talks/zapier-vitor-evals/">
<span class="md-ellipsis">
    Building Feedback Systems for AI Products (Vitor, Zapier)
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
<span class="md-ellipsis">
    Coding Agents
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_5_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_5">
<span class="md-nav__icon md-icon"></span>
            Coding Agents
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../talks/rag-is-dead-cline-nik/">
<span class="md-ellipsis">
    Autonomous Coding Agents (Nik Pash, Cline)
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../talks/colin-rag-agents/">
<span class="md-ellipsis">
    Agentic RAG (Colin Flaherty)
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
<span class="md-ellipsis">
    Document Processing
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_6_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_6">
<span class="md-nav__icon md-icon"></span>
            Document Processing
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../talks/reducto-docs-adit/">
<span class="md-ellipsis">
    Better RAG Through Better Data (Adit, Reducto)
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../talks/superlinked-encoder-stacking/">
<span class="md-ellipsis">
    Encoder Stacking and Multi-Modal Retrieval (Daniel, Superlinked)
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    Resources
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            Resources
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../misc/learning-goals/">
<span class="md-ellipsis">
    Learning Goals
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../misc/what-i-want-you-to-takeaway/">
<span class="md-ellipsis">
    Key Takeaways
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../misc/introduction/">
<span class="md-ellipsis">
    Introduction
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../misc/landingpage/">
<span class="md-ellipsis">
    Landing Page
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#specialized-approaches-for-different-modalities">
<span class="md-ellipsis">
      Specialized Approaches for Different Modalities
    </span>
</a>
<nav aria-label="Specialized Approaches for Different Modalities" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#document-search-beyond-basic-chunking">
<span class="md-ellipsis">
      Document Search: Beyond Basic Chunking
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#image-search-bridging-visual-and-textual-understanding">
<span class="md-ellipsis">
      Image Search: Bridging Visual and Textual Understanding
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#table-search-structured-data-in-context">
<span class="md-ellipsis">
      Table Search: Structured Data in Context
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#sql-query-generation-a-case-study-in-capability-building">
<span class="md-ellipsis">
      SQL Query Generation: A Case Study in Capability Building
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#bringing-it-all-together">
<span class="md-ellipsis">
      Bringing It All Together
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="implementing-multimodal-search-specialized-retrieval-techniques">Implementing Multimodal Search: Specialized Retrieval Techniques</h1>
<div class="admonition abstract">
<p class="admonition-title">Chapter Overview</p>
</div>
<div class="highlight"><pre><span></span><code>This part explores the practical implementation of specialized retrieval techniques:

- Implementing strategies for document, image, and table retrieval
- Building effective SQL generation capabilities
- Creating rich descriptions for non-text content
- Combining specialized retrievers into a cohesive system
</code></pre></div>
<h2 id="specialized-approaches-for-different-modalities">Specialized Approaches for Different Modalities</h2>
<p>Different types of content demand different retrieval strategies. Let's explore approaches for three common modalities: documents, images, and tables.</p>
<h3 id="document-search-beyond-basic-chunking">Document Search: Beyond Basic Chunking</h3>
<p>For document retrieval, the foundation remains chunking documents with appropriate metadata and applying both lexical and semantic search techniques. However, several refinements can dramatically improve performance:</p>
<div class="admonition tip">
<p class="admonition-title">Page-Level Chunking for Documentation</p>
<p><strong>When to Use Page-Level Chunks:</strong>
- Documentation websites (respect page boundaries)
- User manuals (preserve context)
- Legal documents (maintain clause integrity)
- Academic papers (keep sections together)</p>
<p><strong>Why It Works:</strong>
- Documentation is carefully organized by authors
- Semantic boundaries align with page/section breaks
- Users expect complete answers from single pages
- Reduces context fragmentation</p>
<p><strong>Implementation:</strong>
<div class="highlight"><pre><span></span><code><span class="c1"># Instead of arbitrary chunking:</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="n">chunk_by_tokens</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span>

<span class="c1"># Use page-aware chunking:</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="n">chunk_by_pages</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> 
                      <span class="n">respect_sections</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">min_size</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
                      <span class="n">max_size</span><span class="o">=</span><span class="mi">2000</span><span class="p">)</span>
</code></pre></div></p>
</div>
<div class="admonition info">
<p class="admonition-title">Advanced Document Retrieval Techniques</p>
</div>
<p>- <strong>Contextual Retrieval</strong>: Rather than using fixed chunks, dynamically rewrite or expand chunks based on the query context. This creates "query-aware" text representations that better match user intent.</p>
<p>- <strong>Hybrid Retrieval Signals</strong>: Combine semantic similarity with other signals like recency, authority, and citation frequency to create a more nuanced ranking function.</p>
<p>- <strong>Multi-stage Retrieval</strong>: Implement a cascade of increasingly sophisticated (and computationally expensive) retrieval and ranking steps, filtering out irrelevant content at each stage.</p>
<div class="admonition example">
<p class="admonition-title">Contextual Retrieval Implementation</p>
<p><strong>The Power of Context-Aware Chunks:</strong></p>
<p>Original chunk: "Jason the doctor is unhappy with Patient X"</p>
<p>Without context, this is ambiguous:
- Is Jason a medical doctor unhappy with a patient?
- Is a doctor named Jason unhappy?
- Is someone consulting Dr. Jason about Patient X?</p>
<p><strong>Solution: Rewrite chunks with full document context:</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_contextual_chunk</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="n">document</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Rewrite chunk with document context."""</span>
    <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"""</span>
<span class="s2">    Document context: </span><span class="si">{</span><span class="n">document</span><span class="o">.</span><span class="n">title</span><span class="si">}</span>
<span class="s2">    Section: </span><span class="si">{</span><span class="n">chunk</span><span class="o">.</span><span class="n">section</span><span class="si">}</span>

<span class="s2">    Original chunk: </span><span class="si">{</span><span class="n">chunk</span><span class="o">.</span><span class="n">text</span><span class="si">}</span>

<span class="s2">    Rewrite this chunk to include necessary context </span>
<span class="s2">    so it can be understood in isolation.</span>
<span class="s2">    """</span>

    <span class="k">return</span> <span class="n">llm</span><span class="o">.</span><span class="n">complete</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
</code></pre></div>
<p>Result: "In this employee feedback document, Jason (the medical doctor 
on our staff) expressed dissatisfaction with the Patient X project 
management software due to frequent crashes."</p>
<p><strong>Key Decision: Compute at write-time vs read-time</strong>
- Write-time: Higher storage cost, faster retrieval
- Read-time: Lower storage cost, slower retrieval
- Most teams should compute at write-time for production</p>
</div>
<div class="highlight"><pre><span></span><code>flowchart LR
    A[Query] --&gt; B[Initial Retrieval]
    B --&gt; C[Candidate Chunks]
    C --&gt; D[Re-ranking]
    D --&gt; E[Dynamic Expansion]
    E --&gt; F[Final Context]
</code></pre></div>
<p>The result is a document retrieval system that might return different types of content depending on the query:</p>
<ul>
<li>For some queries, concise summaries of key information</li>
<li>For others, entire documents leveraging long-context models</li>
<li>For yet others, specific text chunks or structured data extracts</li>
</ul>
<p>This flexibility allows the system to balance precision, recall, and presentation based on what best serves each query.</p>
<div class="admonition example">
<p class="admonition-title">Document Processor with Contextual Retrieval</p>
</div>
<div class="highlight"><pre><span></span><code>```python
from typing import List, Dict, Any
import re

def process_document_for_retrieval(document: str) -&gt; Dict[str, Any]:
    """
    Process a document for enhanced retrieval capabilities.

    Args:
        document: The raw document text

    Returns:
        Dictionary with processed document components
    """
    # Extract structured metadata
    metadata = extract_document_metadata(document)

    # Create standard chunks with overlap
    chunks = chunk_document(document, chunk_size=800, overlap=0.5)

    # Generate summaries at different levels
    document_summary = summarize_document(document)
    section_summaries = [summarize_section(section) for section in extract_sections(document)]

    # Extract any structured data tables
    tables = extract_tables(document)

    return {
        "metadata": metadata,
        "chunks": chunks,
        "document_summary": document_summary,
        "section_summaries": section_summaries,
        "tables": tables,
        "full_document": document  # Keep original for potential long-context processing
    }

def contextual_retrieval(query: str, document_store: List[Dict[str, Any]]) -&gt; List[str]:
    """
    Perform contextual retrieval that adapts based on query type.

    Args:
        query: User query
        document_store: Processed document store

    Returns:
        List of most relevant text chunks for the query
    """
    # Analyze query to determine retrieval strategy
    query_analysis = analyze_query(query)

    if query_analysis["requires_specific_detail"]:
        # Use chunk-level retrieval for specific information
        return retrieve_relevant_chunks(query, document_store)

    elif query_analysis["requires_overview"]:
        # Use summary-level retrieval for broader questions
        return retrieve_relevant_summaries(query, document_store)

    elif query_analysis["requires_structured_data"]:
        # Use table retrieval for data-oriented questions
        return retrieve_relevant_tables(query, document_store)

    else:
        # Fall back to hybrid approach
        chunks = retrieve_relevant_chunks(query, document_store)
        summaries = retrieve_relevant_summaries(query, document_store)
        return rerank_combined_results(query, chunks + summaries)
```
</code></pre></div>
<h3 id="image-search-bridging-visual-and-textual-understanding">Image Search: Bridging Visual and Textual Understanding</h3>
<p>Image search presents unique challenges. Visual language models were trained primarily on captioning data, creating a potential mismatch between how queries are phrased and how images are represented.</p>
<div class="admonition warning">
<p class="admonition-title">Embedding Spaces Mismatch</p>
</div>
<p>The naive approach—applying the same embedding strategy used for text—often fails because question embeddings and image caption embeddings exist in fundamentally different semantic spaces. Simply embedding captions like "two people" will not retrieve well when users search for "business meeting" or "team collaboration."</p>
<div class="admonition tip">
<p class="admonition-title">When to Use Vision Language Models</p>
<p>According to Adit from Reducto, VLMs excel at "things that traditional OCR has always been horrible at" - handwriting, charts, figures, and diagrams. However, for clean structured information, traditional CV provides better precision and token efficiency. <a href="../../talks/reducto-docs-adit/">Learn about their hybrid approach →</a></p>
</div>
<p>To bridge this gap, more sophisticated image summarization techniques are essential:</p>
<div class="admonition example">
<p class="admonition-title">Advanced Image Description Techniques</p>
</div>
<p><strong>Rich Prompting</strong>: Move beyond simple "what's in this image?" prompts to detailed instructions that anticipate likely queries. Compare:</p>
<div class="highlight"><pre><span></span><code>*Basic*: "Describe this image."
→ Result: "Two people at a table."

*Better*: "Describe this image in detail, noting the number of people, their apparent relationship, the setting, lighting conditions, objects present, and any text visible in the image."
→ Result: "Two people arguing across a dinner table in a dimly lit room. One person appears agitated while the other looks defensive. A knife is visible on the table."

*Optimal*: "Analyze this image comprehensively as if you were making it searchable in a database. Include details about the people, their emotions, the environment, lighting, objects, potential context, and any visible text. Consider how someone might search for this specific image."
→ Result: "This dramatic image shows two business professionals in a tense negotiation across a polished conference table in a corporate boardroom with floor-to-ceiling windows overlooking a city skyline. The older man in a gray suit appears frustrated, gesturing emphatically with papers in hand, while the younger woman in a black blazer maintains a composed but firm expression. Multiple financial reports and what appears to be a contract are spread across the table. The scene is captured in natural lighting with dramatic shadows, suggesting a high-stakes discussion or disagreement over business terms."
</code></pre></div>
<div class="admonition quote">
<p class="admonition-title">From Industry Experience</p>
</div>
<p>"We found that the difference between basic image descriptions and optimized ones led to a 40% increase in successful retrievals. The key was training our team to create prompts that anticipated the vocabulary users would actually employ in their searches."</p>
<div class="admonition info">
<p class="admonition-title">Additional Image Enhancement Approaches</p>
</div>
<p>- <strong>Contextual Enrichment</strong>: Incorporate surrounding text, OCR results from the image, and metadata about the image's source and purpose. For example, if an image appears in a product manual, include the product name and function in the description.</p>
<div class="highlight"><pre><span></span><code>- **Visual Reasoning**: Use chain-of-thought prompting to guide the model through a reasoning process about the image content, resulting in more comprehensive descriptions. For example: "First identify all objects in the image. Then consider how they relate to each other. Finally, determine what activity or process is being depicted."

- **Bounding Boxes and Visual Grounding**: For applications where precise location or counting is important, supplement descriptions with information about the spatial arrangement of elements. This is particularly valuable in construction, manufacturing, and retail contexts where users often need to locate or count specific items.
</code></pre></div>
<div class="admonition example">
<p class="admonition-title">Construction Site Image Analysis</p>
</div>
<p>For a construction company's image database, users frequently needed to count specific items ("How many support beams are installed?") or locate defects ("Show me images of cracked foundations"). By implementing bounding box detection alongside rich descriptions, retrieval accuracy for these queries improved by 65% compared to using only semantic descriptions.</p>
<div class="admonition example">
<p class="admonition-title">Rich Image Description Prompt</p>
</div>
<p>```python
def generate_rich_image_description(image, ocr_text=None, surrounding_text=None):
"""
Generate a comprehensive description optimized for retrieval.</p>
<div class="highlight"><pre><span></span><code>    Args:
        image: Image data or path
        ocr_text: Optional text extracted from the image
        surrounding_text: Optional text surrounding the image in its original context

    Returns:
        Detailed description of the image
    """
    prompt = f"""
    # Image Analysis Task

    ## Context Information
    {"OCR Text from image: " + ocr_text if ocr_text else "No OCR text available."}
    {"Surrounding context: " + surrounding_text if surrounding_text else "No surrounding context available."}

    ## Analysis Instructions
    Analyze the following image in extreme detail:

    1. First, describe the visual scene, setting, and overall composition
    2. List all people visible, their approximate positions, actions, and expressions
    3. Enumerate all objects visible in the image
    4. Note any text visible in the image
    5. Describe colors, lighting, and visual style
    6. If applicable, identify the type of image (photograph, diagram, screenshot, etc.)
    7. Use chain-of-thought reasoning: think about what is happening and why
    8. Generate 5-7 potential questions someone might ask when searching for this image
    9. Suggest 5-10 relevant tags for this image

    ## Final Description
    Based on your analysis, provide a comprehensive 3-5 sentence description that would
    help people find this image when searching with natural language queries.
    """

    # Use this prompt with your vision model implementation
    # ...
```
</code></pre></div>
<p>The enhanced description dramatically improves retrieval capability when troubleshooting specific defects or components.</p>
<h3 id="table-search-structured-data-in-context">Table Search: Structured Data in Context</h3>
<p>Tables present a dual challenge: they contain structured data but exist within unstructured contexts. Two main approaches prove effective:</p>
<div class="admonition quote">
<p class="admonition-title">Expert Insight: Document Parsing Challenges</p>
<p>Adit from Reducto emphasizes that tables are particularly challenging: "Tables are particularly challenging because they represent two-dimensional associations of data that can be formatted in countless ways. The failures are often subtle - a model might extract what appears to be a valid table but silently drop rows, columns, or individual values."</p>
<p>For production-ready table extraction, consider specialized tools. <a href="../../talks/reducto-docs-adit/">Learn more about document ingestion best practices →</a></p>
</div>
<div class="admonition success">
<p class="admonition-title">Markdown Tables: The Surprising Winner</p>
<p><strong>Performance Comparison for Table Lookups:</strong>
- Markdown tables: 85% accuracy
- CSV format: 73% accuracy
- JSON format: 71% accuracy<br/>
- YAML format: 69% accuracy</p>
<p><strong>Why Markdown Tables Win:</strong>
- Visual structure helps LLMs understand relationships
- Column alignment provides natural grouping
- Headers are clearly distinguished
- Less token overhead than JSON/YAML</p>
<p><strong>Best Practices:</strong>
<div class="highlight"><pre><span></span><code>| Product ID | Name           | Price  | Stock |
|------------|----------------|--------|-------|
| SKU-001    | Widget Pro     | $29.99 | 150   |
| SKU-002    | Widget Basic   | $19.99 | 0     |
| SKU-003    | Widget Premium | $49.99 | 75    |
</code></pre></div></p>
<p><strong>Pro Tip:</strong> For financial data, beware of spacing in numbers!
- Bad: <code>1 234 567</code> (tokenizes as three separate numbers)
- Good: <code>1234567</code> or <code>1,234,567</code></p>
<div class="admonition info">
<p class="admonition-title">Production Table Extraction</p>
<p>Reducto's approach to complex tables includes:
- Using HTML for tables with 3+ merged cells
- Traditional CV for initial extraction, VLMs for correction
- Creating natural language summaries for better retrieval</p>
<p>See their <a href="../../talks/reducto-docs-adit/">complete document parsing methodology</a> for handling PDFs, Excel files, and complex layouts.</p>
</div>
</div>
<div class="admonition info">
<p class="admonition-title">Table Retrieval Approaches</p>
</div>
<p><strong>Approach 1: Table as Document</strong></p>
<div class="highlight"><pre><span></span><code>For finding specific rows or comparing data across tables, chunk the table (preserving headers) and apply semantic search techniques. Generate summaries that capture the table's purpose and key insights to improve retrieval.

This works well for questions like "Which product had the highest Q3 sales?" or "Show me all tables with warranty information."

**Approach 2: Table as Database**

For detailed data analysis, treat tables as queryable databases. The key challenge becomes identifying which table(s) to query for a given question.

Standardize schemas using CREATE TABLE statements or table descriptions, then build semantic search against these table representations. Include sample data when possible to help clarify the table's contents.
</code></pre></div>
<div class="admonition example">
<p class="admonition-title">Table Processor Implementation</p>
</div>
<p>```python
from typing import List, Dict, Any, Optional
import pandas as pd</p>
<div class="highlight"><pre><span></span><code>class TableProcessor:
    """Process tables for enhanced retrievability and querying."""

    def process_table(self, table_data: pd.DataFrame, table_name: str,
                    source_doc: Optional[str] = None) -&gt; Dict[str, Any]:
        """
        Process a table for both document-like and database-like retrieval.

        Args:
            table_data: The table as a pandas DataFrame
            table_name: Name of the table
            source_doc: Optional source document information

        Returns:
            Dictionary with processed table components
        """
        # Generate schema representation
        schema = self._generate_schema_representation(table_data)

        # Generate natural language summary
        summary = self._generate_table_summary(table_data, table_name)

        # Generate sample queries this table could answer
        sample_queries = self._generate_sample_queries(table_data, table_name)

        # Convert to text chunks for semantic search
        text_chunks = self._table_to_text_chunks(table_data)

        return {
            "table_name": table_name,
            "schema": schema,
            "summary": summary,
            "sample_queries": sample_queries,
            "text_chunks": text_chunks,
            "raw_data": table_data,
            "source_document": source_doc
        }

    def _generate_schema_representation(self, df: pd.DataFrame) -&gt; str:
        """Generate a SQL-like schema representation."""
        types = []
        for col in df.columns:
            dtype = df[col].dtype
            if pd.api.types.is_numeric_dtype(dtype):
                sql_type = "NUMERIC"
            elif pd.api.types.is_datetime64_dtype(dtype):
                sql_type = "TIMESTAMP"
            else:
                sql_type = "TEXT"

            # Add sample values for better understanding
            sample_values = df[col].dropna().unique()[:3]
            sample_str = f"Sample values: {', '.join(str(x) for x in sample_values)}"

            types.append(f"{col} {sql_type} -- {sample_str}")

        return f"CREATE TABLE table (\n  " + ",\n  ".join(types) + "\n);"

    def _generate_table_summary(self, df: pd.DataFrame, table_name: str) -&gt; str:
        """Generate a natural language summary of the table."""
        # Use an LLM to summarize the table contents
        # Implementation depends on your LLM framework
        # ...

    def _generate_sample_queries(self, df: pd.DataFrame, table_name: str) -&gt; List[str]:
        """Generate sample natural language queries this table could answer."""
        # Use an LLM to generate sample queries
        # ...

    def _table_to_text_chunks(self, df: pd.DataFrame) -&gt; List[str]:
        """Convert table to text chunks for semantic search."""
        # Implementation for chunking table content
        # ...
```
</code></pre></div>
<p>Once the right table is identified, either:</p>
<ul>
<li>Place the table directly into the context for simple analysis</li>
<li>Generate SQL queries or pandas code for more complex analysis</li>
</ul>
<h2 id="sql-query-generation-a-case-study-in-capability-building">SQL Query Generation: A Case Study in Capability Building</h2>
<p>SQL query generation exemplifies many of the principles we've discussed. It involves both an inventory challenge (finding the right tables) and a capability challenge (writing effective queries).</p>
<div class="admonition warning">
<p class="admonition-title">Limitations of Direct Translation</p>
</div>
<p>The classical approach—training a model to translate natural language directly to SQL—often struggles with complex schemas and business-specific query patterns. The limitations become especially apparent with:</p>
<div class="highlight"><pre><span></span><code>- Complex schemas with dozens or hundreds of tables
- Business-specific definitions of common terms like "active user" or "revenue"
- SQL patterns that require specific business rules like fiscal calendars
- Performance considerations that require specific optimization techniques
</code></pre></div>
<div class="admonition quote">
<p class="admonition-title">Data Science Experience</p>
</div>
<p>"We spent months trying to fine-tune models for SQL generation with limited success. Once we switched to retrieving exemplar queries from our analytics repository, accuracy jumped by 30% overnight."</p>
<div class="admonition example">
<p class="admonition-title">RAPTOR: Recursive Summarization for Long Documents</p>
<p><strong>The RAPTOR Approach:</strong></p>
<p>When dealing with concepts that span multiple pages or sections:</p>
<ol>
<li>
<p><strong>Cluster Related Chunks:</strong>
<div class="highlight"><pre><span></span><code><span class="c1"># Embed all chunks</span>
<span class="n">embeddings</span> <span class="o">=</span> <span class="p">[</span><span class="n">embed</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span> <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">]</span>

<span class="c1"># Cluster similar chunks</span>
<span class="n">clusters</span> <span class="o">=</span> <span class="n">cluster_embeddings</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> 
                            <span class="n">method</span><span class="o">=</span><span class="s1">'hierarchical'</span><span class="p">,</span>
                            <span class="n">threshold</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
</code></pre></div></p>
</li>
<li>
<p><strong>Summarize Each Cluster:</strong>
<div class="highlight"><pre><span></span><code><span class="k">for</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="n">clusters</span><span class="p">:</span>
    <span class="n">summary</span> <span class="o">=</span> <span class="n">summarize_chunks</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">chunks</span><span class="p">)</span>
    <span class="n">cluster</span><span class="o">.</span><span class="n">summary</span> <span class="o">=</span> <span class="n">summary</span>
</code></pre></div></p>
</li>
<li>
<p><strong>Build Hierarchical Index:</strong></p>
</li>
<li>Leaf nodes: Original chunks</li>
<li>Internal nodes: Cluster summaries</li>
<li>
<p>Root node: Document summary</p>
</li>
<li>
<p><strong>Multi-Level Retrieval:</strong></p>
</li>
<li>Start with high-level summaries</li>
<li>Drill down to specific chunks as needed</li>
</ol>
<p><strong>Use Cases:</strong>
- Academic papers (methodology across sections)
- Legal documents (related clauses)
- Technical documentation (feature descriptions)
- Books and long-form content</p>
<p>This approach handles the "information spread" problem where relevant content is distributed across multiple non-contiguous sections.</p>
</div>
<div class="admonition info">
<p class="admonition-title">When Simple Tools Beat Embeddings</p>
<p>Colin Flaherty's experience building top-performing coding agents reveals that sometimes simple tools like grep and find can outperform embedding-based retrieval: "The agent's persistence compensated for less sophisticated tools." However, he notes this works best for:
- Highly structured content like code
- Small to medium-sized repositories
- When distinctive keywords exist</p>
<p>For larger codebases or unstructured content, embeddings become essential. <a href="../../talks/colin-rag-agents/">Explore agentic retrieval patterns →</a></p>
</div>
<div class="admonition tip">
<p class="admonition-title">RAG Playbook for SQL Generation</p>
</div>
<p>A more effective strategy applies our RAG playbook:</p>
<div class="highlight"><pre><span></span><code>1. **Build an inventory of tables and their descriptions** - Create detailed schema documentation including sample data
2. **Create synthetic questions targeting this inventory** - Generate diverse questions that test different joining patterns
3. **Measure retrieval performance for table selection** - Evaluate if the right tables are being identified
4. **Collect exemplar SQL queries demonstrating important capabilities** - Curate a library of well-written, optimized queries
5. **Include these exemplars when generating new queries** - Dynamically retrieve and include relevant examples
</code></pre></div>
<p>This approach addresses a fundamental challenge in SQL generation: the same question can be interpreted in multiple valid ways. Consider "Show me month-over-month revenue growth":</p>
<ul>
<li>Does "month" mean calendar month or a 28-day period?</li>
<li>Should weekends be excluded for B2B applications?</li>
<li>Is "growth" absolute or percentage?</li>
<li>Should the calculation include or exclude certain revenue types?</li>
<li>Should the comparison use the same day of month or the last day of each month?</li>
<li>How should partial months be handled when the current month isn't complete?</li>
</ul>
<div class="admonition example">
<p class="admonition-title">Subjective Query Interpretations</p>
</div>
<p>| Question | Possible Interpretation 1 | Possible Interpretation 2 | Possible Interpretation 3 |
|----------|---------------------------|---------------------------|---------------------------|
| "Monthly active users" | Users who logged in during calendar month | Users who performed an action in last 30 days | Users who made a purchase in billing cycle |
| "Revenue by region" | Geographic sales regions | Product categories | Customer segments |
| "Top performing products" | Highest revenue | Highest profit margin | Highest growth rate |</p>
<p>Without business context, even the most advanced models can only guess. By including relevant exemplars that demonstrate how your organization typically answers such questions, you guide the model toward your preferred interpretations.</p>
<h2 id="bringing-it-all-together">Bringing It All Together</h2>
<p>As we prepare for our final session on routing and unified systems, let's solidify the key insights from today's exploration of multimodal RAG:</p>
<div class="admonition abstract">
<p class="admonition-title">Key Takeaways</p>
</div>
<p>1. <strong>The power of specialization</strong>: Building dedicated retrieval mechanisms for different content types and query patterns consistently outperforms monolithic approaches. Specialized models solving specific problems will outperform general-purpose solutions.</p>
<p>2. <strong>Two complementary strategies</strong>: Extract structured data from unstructured content, or create synthetic text chunks that point to source data—both serve as AI-powered materialized views that optimize retrievability.</p>
<p>3. <strong>Measurement drives improvement</strong>: Use precision and recall at both the router and retriever levels to identify your system's limiting factors using the formula: P(finding correct data) = P(selecting correct retriever) × P(finding correct data | correct retriever).</p>
<p>4. <strong>Modality-specific optimizations</strong>: Each content type requires tailored approaches, from contextual retrieval for documents to rich descriptions for images to exemplar-based generation for SQL.</p>
<p>5. <strong>Organizational benefits</strong>: Beyond performance, specialized indices enable division of labor, incremental improvement, and targeted innovation without disrupting the entire system.</p>
<div class="admonition tip">
<p class="admonition-title">Combining Lexical and Semantic Search</p>
<p><strong>The Power of Hybrid Search:</strong></p>
<p>Don't abandon lexical search! It excels at:
- Exact matches (product codes, names)
- Technical terms and abbreviations
- Queries with specific keywords</p>
<p><strong>Implementation Strategy:</strong>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">hybrid_search</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="c1"># Get results from both systems</span>
    <span class="n">semantic_results</span> <span class="o">=</span> <span class="n">semantic_search</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">lexical_results</span> <span class="o">=</span> <span class="n">bm25_search</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Combine with weighted scores</span>
    <span class="n">combined</span> <span class="o">=</span> <span class="n">merge_results</span><span class="p">(</span>
        <span class="n">semantic_results</span><span class="p">,</span> 
        <span class="n">lexical_results</span><span class="p">,</span>
        <span class="n">semantic_weight</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
        <span class="n">lexical_weight</span><span class="o">=</span><span class="mf">0.3</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">combined</span><span class="p">[:</span><span class="n">k</span><span class="p">]</span>
</code></pre></div></p>
<p><strong>Pro Tip:</strong> Adjust weights based on query type:
- Technical queries: Increase lexical weight
- Conceptual queries: Increase semantic weight
- Let user behavior guide the optimization</p>
</div>
<div class="highlight"><pre><span></span><code>flowchart TD
    A[User Query] --&gt; B[Query Analyzer]
    B --&gt; C[Query Router]

    C --&gt;|Document Query| D[Document Retriever]
    C --&gt;|Image Query| E[Image Retriever]
    C --&gt;|Table Query| F[Table Retriever]
    C --&gt;|SQL Query| G[SQL Generator]

    D --&gt; H[Result Combiner]
    E --&gt; H
    F --&gt; H
    G --&gt; H

    H --&gt; I[Response Generator]
    I --&gt; J[User Response]
</code></pre></div>
<p>The beauty of this framework is its recursive nature. The same playbook—synthetic data generation, segmentation, capability identification—applies whether you're building your first retrieval system or your fifth specialized index.</p>
<div class="admonition tip">
<p class="admonition-title">Implementation Strategy</p>
</div>
<p>1. <strong>Start small</strong>: Begin with one or two specialized retrievers for your highest-impact query types
2. <strong>Measure relentlessly</strong>: Track performance metrics for each retriever and overall system
3. <strong>Expand incrementally</strong>: Add new retrievers as you identify segments that would benefit
4. <strong>Refine continuously</strong>: Use user feedback to improve both routing and retrieval quality
5. <strong>Optimize alignment</strong>: Ensure that your synthetic text and metadata extraction aligns with actual user query patterns</p>
<div class="admonition quote">
<p class="admonition-title">Engineering Insight</p>
</div>
<p>"No matter how much better AI gets, you'll always be responsible for retrieval. Understanding what to retrieve and how to retrieve it remains the core challenge even as models become more capable."</p>
<div class="admonition tip">
<p class="admonition-title">Cross-Reference</p>
</div>
<p>In <a href="../chapter6-1/">Chapter 6</a>, we'll explore how to bring these specialized components together through effective routing strategies, creating a unified system that seamlessly directs users to the appropriate retrievers based on their queries.</p>
<hr/>
<p>IF you want to get discounts and 6 day email source on the topic make sure to subscribe to</p>
<script async="" data-uid="010fd9b52b" src="https://fivesixseven.kit.com/010fd9b52b/index.js"></script>
<aside class="md-source-file">
<span class="md-source-file__fact">
<span class="md-icon" title="Last update">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"></path></svg>
</span>
<span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="July 5, 2025 04:32:08 UTC">July 5, 2025</span>
</span>
</aside>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: Understanding" class="md-footer__link md-footer__link--prev" href="../chapter5-1/">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</div>
<div class="md-footer__title">
<span class="md-footer__direction">
                Previous
              </span>
<div class="md-ellipsis">
                Understanding
              </div>
</div>
</a>
<a aria-label="Next: Routing" class="md-footer__link md-footer__link--next" href="../chapter6-1/">
<div class="md-footer__title">
<span class="md-footer__direction">
                Next
              </span>
<div class="md-ellipsis">
                Routing
              </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://twitter.com/jxnlco" rel="noopener" target="_blank" title="twitter.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["announce.dismiss", "navigation.instant", "navigation.tracking", "navigation.expand", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.footer", "search.highlight", "search.share", "search.suggest", "toc.follow", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="../../javascripts/mathjax.js"></script>
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>