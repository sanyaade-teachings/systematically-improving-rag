
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Learn how to measure system performance and build continuous improvement cycles">
      
      
      
        <link rel="canonical" href="https://567-labs.github.io/systematically-improving-rag/workshops/chapter6-3/">
      
      
        <link rel="prev" href="../chapter6-2/">
      
      
        <link rel="next" href="../../office-hours/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.15">
    
    
      
        <title>Performance Measurement and Improvement - Systematically Improving RAG Applications</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config",""),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="black">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#performance-measurement-and-improvement-building-learning-systems" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
              <button class="md-banner__button md-icon" aria-label="Don't show this again">
                
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
              </button>
            
            
  <p>
    This material is supported by <a href="https://maven.com/applied-llms/rag-playbook?promoCode=EBOOK" target="_blank"><strong>Applied LLMs on Maven</strong></a>.  Readers get 20% off.
    Not ready? Check out the <a href="https://fivesixseven.ck.page/rag-crash-course" target="_blank"><strong>free email course</strong></a>.
  </p>

          </div>
          
            <script>var el=document.querySelector("[data-md-component=announce]");if(el){var content=el.querySelector(".md-typeset");__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0)}</script>
          
        </aside>
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Systematically Improving RAG Applications" class="md-header__button md-logo" aria-label="Systematically Improving RAG Applications" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Systematically Improving RAG Applications
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Performance Measurement and Improvement
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="black"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
    
  
  Workshops

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../office-hours/" class="md-tabs__link">
          
  
  
    
  
  Office Hours

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../talks/" class="md-tabs__link">
          
  
  
    
  
  Talks

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Systematically Improving RAG Applications" class="md-nav__button md-logo" aria-label="Systematically Improving RAG Applications" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Systematically Improving RAG Applications
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Workshops
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Workshops
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Chapter 1: Starting the Flywheel
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Chapter 1: Starting the Flywheel
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Chapter 2: From Evaluation to Enhancement
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Chapter 2: From Evaluation to Enhancement
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Chapter 3: User Experience
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            Chapter 3: User Experience
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter3-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Design Principles
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter3-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Feedback Collection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter3-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Iterative Improvement
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Chapter 4: Topic Modeling
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            Chapter 4: Topic Modeling
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter4-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Analysis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter4-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prioritization
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_7" >
        
          
          <label class="md-nav__link" for="__nav_2_7" id="__nav_2_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Chapter 5: Multimodal Capabilities
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            Chapter 5: Multimodal Capabilities
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter5-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Understanding
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter5-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Implementation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_8" checked>
        
          
          <label class="md-nav__link" for="__nav_2_8" id="__nav_2_8_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Chapter 6: Architecture
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_8">
            <span class="md-nav__icon md-icon"></span>
            Chapter 6: Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter6-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Routing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter6-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tools
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Improvement
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Improvement
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#chapter-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Chapter Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-query-routing-effectiveness" class="md-nav__link">
    <span class="md-ellipsis">
      Testing Query Routing Effectiveness
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing Query Routing Effectiveness">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tool-selection-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Tool Selection Metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automating-router-evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      Automating Router Evaluation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#analyzing-tool-selection-failures" class="md-nav__link">
    <span class="md-ellipsis">
      Analyzing Tool Selection Failures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#confusion-matrix-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Confusion Matrix Analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#targeted-improvement-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      Targeted Improvement Strategy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-interfaces-direct-tool-access" class="md-nav__link">
    <span class="md-ellipsis">
      User Interfaces: Direct Tool Access
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User Interfaces: Direct Tool Access">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dual-mode-ui-example" class="md-nav__link">
    <span class="md-ellipsis">
      Dual-Mode UI Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#specialized-interface-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Specialized Interface Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Specialized Interface Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#blueprint-search-interface" class="md-nav__link">
    <span class="md-ellipsis">
      Blueprint Search Interface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#document-search-interface" class="md-nav__link">
    <span class="md-ellipsis">
      Document Search Interface
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-feedback-as-training-data" class="md-nav__link">
    <span class="md-ellipsis">
      User Feedback as Training Data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User Feedback as Training Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#user-feedback-collection-mechanisms" class="md-nav__link">
    <span class="md-ellipsis">
      User Feedback Collection Mechanisms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementing-a-feedback-loop" class="md-nav__link">
    <span class="md-ellipsis">
      Implementing a Feedback Loop
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#success-formula" class="md-nav__link">
    <span class="md-ellipsis">
      Success Formula
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Success Formula">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diagnostic-framework" class="md-nav__link">
    <span class="md-ellipsis">
      Diagnostic Framework
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#independent-measurement" class="md-nav__link">
    <span class="md-ellipsis">
      Independent Measurement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from-metrics-to-roadmap" class="md-nav__link">
    <span class="md-ellipsis">
      From Metrics to Roadmap
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Summary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-improvement-process" class="md-nav__link">
    <span class="md-ellipsis">
      The Improvement Process
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../office-hours/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Office Hours
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Office Hours
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../office-hours/faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FAQ
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../office-hours/AGENTS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Agents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 1: Starting the Flywheel
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Chapter 1: Starting the Flywheel
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../office-hours/cohort2/week1-summary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cohort 2 - Week 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../office-hours/cohort3/week-1-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cohort 3 - Session 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../office-hours/cohort3/week-1-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cohort 3 - Session 2
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 2: From Evaluation to Enhancement
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            Chapter 2: From Evaluation to Enhancement
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../office-hours/cohort2/week2-summary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cohort 2 - Week 2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../office-hours/cohort3/week-2-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cohort 3 - Session 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../office-hours/cohort3/week-2-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cohort 3 - Session 2
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 3: User Experience
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            Chapter 3: User Experience
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../office-hours/cohort2/week3-summary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cohort 2 - Week 3
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../office-hours/cohort3/week-3-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cohort 3 - Session 1
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_7" >
        
          
          <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 4: Topic Modeling
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            Chapter 4: Topic Modeling
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../office-hours/cohort2/week4-summary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cohort 2 - Week 4
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../office-hours/cohort3/week-4-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cohort 3 - Session 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../office-hours/cohort3/week-4-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cohort 3 - Session 2
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_8" >
        
          
          <label class="md-nav__link" for="__nav_3_8" id="__nav_3_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 5: Multimodal Capabilities
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8">
            <span class="md-nav__icon md-icon"></span>
            Chapter 5: Multimodal Capabilities
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../office-hours/cohort2/week5-summary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cohort 2 - Week 5
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../office-hours/cohort3/week-5-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cohort 3 - Session 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../office-hours/cohort3/week-5-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cohort 3 - Session 2
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_9" >
        
          
          <label class="md-nav__link" for="__nav_3_9" id="__nav_3_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 6: Architecture
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_9">
            <span class="md-nav__icon md-icon"></span>
            Chapter 6: Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../office-hours/cohort2/week6-summary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cohort 2 - Week 6
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../talks/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Talks
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Talks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Search / Indexing / Chunking
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Search / Indexing / Chunking
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../talks/chromadb-anton-chunking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Text Chunking Strategies (Anton, ChromaDB)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../talks/john-lexical-search/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lexical Search in RAG Applications (John Berryman)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../talks/query-routing-anton/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Query Routing for RAG Systems (Anton, ChromaDB)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../talks/semantic-search-exa-will-bryk/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Why Google Search Sucks for AI (Will Bryk, Exa)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../talks/rag-without-apis-browser-michael-struwig/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    How OpenBB Ditched APIs and Put RAG in the Browser (Michael Struwig)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Finetuning
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Finetuning
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../talks/glean-manav/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Building Custom Embedding Models Per Customer (Manav, Glean)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../talks/fine-tuning-rerankers-embeddings-ayush-lancedb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    The 12% RAG Performance Boost You're Missing (Ayush, LanceDB)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../talks/embedding-performance-generative-evals-kelly-hong/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Stop Trusting MTEB Rankings (Kelly Hong, Chroma)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Monitoring
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            Monitoring
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../talks/online-evals-production-monitoring-ben-sidhant/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Why Your AI Is Failing in Production (Ben & Sidhant)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../talks/rag-antipatterns-skylar-payne/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    The RAG Mistakes That Are Killing Your AI (Skylar Payne)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../talks/zapier-vitor-evals/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    How Zapier 4x'd Their AI Feedback Collection (Vitor)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Coding Agents
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            Coding Agents
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../talks/rag-is-dead-cline-nik/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Why Cline Ditched RAG for Direct Code Reading (Nik Pash)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../talks/colin-rag-agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Grep Beat Embeddings on SWE-Bench (Colin Flaherty, Augment)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../talks/sourcegraph-agentic-code-agent-rag/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Agentic RAG from first principles (Beyang Liu, Sourcegraph)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../talks/devin-cognition-multi-agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Why Devin does not use multi-agents (Walden Yan)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_6" >
        
          
          <label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Document Processing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            Document Processing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../talks/reducto-docs-adit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Why Most Document Parsing Sucks (Adit, Reducto)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../talks/superlinked-encoder-stacking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Encoder Stacking and Multi-Modal Retrieval (Daniel, Superlinked)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../talks/extend-document-automation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    How Extend Achieves 95%+ Document Automation (Eli Badgio)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#chapter-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Chapter Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-query-routing-effectiveness" class="md-nav__link">
    <span class="md-ellipsis">
      Testing Query Routing Effectiveness
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing Query Routing Effectiveness">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tool-selection-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Tool Selection Metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automating-router-evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      Automating Router Evaluation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#analyzing-tool-selection-failures" class="md-nav__link">
    <span class="md-ellipsis">
      Analyzing Tool Selection Failures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#confusion-matrix-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Confusion Matrix Analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#targeted-improvement-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      Targeted Improvement Strategy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-interfaces-direct-tool-access" class="md-nav__link">
    <span class="md-ellipsis">
      User Interfaces: Direct Tool Access
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User Interfaces: Direct Tool Access">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dual-mode-ui-example" class="md-nav__link">
    <span class="md-ellipsis">
      Dual-Mode UI Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#specialized-interface-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Specialized Interface Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Specialized Interface Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#blueprint-search-interface" class="md-nav__link">
    <span class="md-ellipsis">
      Blueprint Search Interface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#document-search-interface" class="md-nav__link">
    <span class="md-ellipsis">
      Document Search Interface
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-feedback-as-training-data" class="md-nav__link">
    <span class="md-ellipsis">
      User Feedback as Training Data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User Feedback as Training Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#user-feedback-collection-mechanisms" class="md-nav__link">
    <span class="md-ellipsis">
      User Feedback Collection Mechanisms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementing-a-feedback-loop" class="md-nav__link">
    <span class="md-ellipsis">
      Implementing a Feedback Loop
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#success-formula" class="md-nav__link">
    <span class="md-ellipsis">
      Success Formula
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Success Formula">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diagnostic-framework" class="md-nav__link">
    <span class="md-ellipsis">
      Diagnostic Framework
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#independent-measurement" class="md-nav__link">
    <span class="md-ellipsis">
      Independent Measurement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from-metrics-to-roadmap" class="md-nav__link">
    <span class="md-ellipsis">
      From Metrics to Roadmap
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Summary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-improvement-process" class="md-nav__link">
    <span class="md-ellipsis">
      The Improvement Process
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="performance-measurement-and-improvement-building-learning-systems">Performance Measurement and Improvement: Building Learning Systems</h1>
<h2 id="chapter-overview">Chapter Overview</h2>
<p>This part explores how to measure, test, and continuously improve a unified RAG system:</p>
<ul>
<li>Testing and measuring performance of both retrieval and routing components</li>
<li>Creating user interfaces that leverage both AI and direct tool access</li>
<li>Building systems that scale across teams and complexity levels</li>
<li>Creating continuous improvement cycles through user feedback</li>
</ul>
<h2 id="testing-query-routing-effectiveness">Testing Query Routing Effectiveness</h2>
<p>Just as we need metrics for retrieval quality, we need metrics for routing quality. The fundamental question is: are we selecting the right tools for each query?</p>
<h3 id="tool-selection-metrics">Tool Selection Metrics</h3>
<p>To evaluate tool selection, we need a test dataset with queries annotated with the correct tool(s) to use. From there, we can calculate:</p>
<ol>
<li><strong>Tool Precision</strong>: When we select a tool, how often is it actually the right one?</li>
<li><strong>Tool Recall</strong>: How often do we select all the tools that should be selected?</li>
<li><strong>Tool F1 Score</strong>: The harmonic mean of precision and recall</li>
<li><strong>Per-Tool Recall</strong>: How often each specific tool is correctly selected when it should be</li>
</ol>
<div class="admonition warning">
<p class="admonition-title">Data Leakage Risk</p>
</div>
<p>When creating test datasets for router evaluation, be vigilant about data leakage. If your few-shot examples appear in your test set, you'll get artificially high performance that won't generalize to real queries. Always maintain separate development and test sets with distinct query patterns.</p>
<p>Here's a sample evaluation for a construction information system's query router:</p>
<table>
<thead>
<tr>
<th>Query ID</th>
<th>Query Text</th>
<th>Expected Tools</th>
<th>Realized Tools</th>
<th>Precision</th>
<th>Recall</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Retrieve blueprints for the museum expansion</td>
<td>SearchBlueprint</td>
<td>SearchBlueprint</td>
<td>100%</td>
<td>1/1</td>
</tr>
<tr>
<td>2</td>
<td>Find schedule and documents for the library renovation</td>
<td>SearchSchedule, SearchText</td>
<td>SearchSchedule</td>
<td>100%</td>
<td>1/2</td>
</tr>
<tr>
<td>3</td>
<td>Get both blueprints and schedule for campus construction</td>
<td>SearchBlueprint, SearchSchedule</td>
<td>SearchBlueprint, SearchSchedule</td>
<td>100%</td>
<td>2/2</td>
</tr>
<tr>
<td>4</td>
<td>Show me contract details and permit requirements for the new office</td>
<td>SearchText, SearchBlueprint</td>
<td>SearchText, SearchBlueprint, SearchSchedule</td>
<td>67%</td>
<td>2/2</td>
</tr>
<tr>
<td>5</td>
<td>Identify materials and design specs for the downtown skyscraper</td>
<td>SearchText, SearchBlueprint</td>
<td>SearchBlueprint, SearchText</td>
<td>100%</td>
<td>2/2</td>
</tr>
<tr>
<td>6</td>
<td>Get full details on industrial park planning</td>
<td>SearchBlueprint, SearchText, SearchSchedule</td>
<td>SearchText, SearchInvoice, SearchPermit</td>
<td>33%</td>
<td>1/3</td>
</tr>
<tr>
<td>7</td>
<td>Find emergency repair guidelines for the abandoned warehouse</td>
<td>SearchRepair, SearchBlueprint</td>
<td>SearchText</td>
<td>0%</td>
<td>0/2</td>
</tr>
<tr>
<td>8</td>
<td>Obtain comprehensive analysis for the urban redevelopment project</td>
<td>SearchBlueprint, SearchText, SearchSchedule, SearchPermit</td>
<td>SearchBlueprint</td>
<td>100%</td>
<td>1/4</td>
</tr>
<tr>
<td>9</td>
<td>Explain zoning regulations for the new industrial area</td>
<td>SearchZoning</td>
<td>SearchBlueprint, SearchText</td>
<td>0%</td>
<td>0/1</td>
</tr>
</tbody>
</table>
<p>Looking at overall metrics, this system achieves:</p>
<ul>
<li>Average Precision: 67%</li>
<li>Average Recall: 56%</li>
<li>Average F1 Score: 61%</li>
</ul>
<p>These aggregate metrics are useful, but they don't tell the complete story. What's often more revealing is the per-tool recall:</p>
<table>
<thead>
<tr>
<th>Tool</th>
<th>Times Expected</th>
<th>Times Selected Correctly</th>
<th>Per-Tool Recall</th>
</tr>
</thead>
<tbody>
<tr>
<td>SearchBlueprint</td>
<td>6</td>
<td>4</td>
<td>67%</td>
</tr>
<tr>
<td>SearchText</td>
<td>5</td>
<td>3</td>
<td>60%</td>
</tr>
<tr>
<td>SearchSchedule</td>
<td>4</td>
<td>2</td>
<td>50%</td>
</tr>
<tr>
<td>SearchPermit</td>
<td>1</td>
<td>0</td>
<td>0%</td>
</tr>
<tr>
<td>SearchZoning</td>
<td>1</td>
<td>0</td>
<td>0%</td>
</tr>
<tr>
<td>SearchRepair</td>
<td>1</td>
<td>0</td>
<td>0%</td>
</tr>
</tbody>
</table>
<p>This breakdown shows that less common tools (Permit, Zoning, Repair) have extremely low recall, suggesting that our router doesn't have enough examples of these tools to recognize when they should be used.</p>
<h3 id="automating-router-evaluation">Automating Router Evaluation</h3>
<p>Here's a code example for evaluating router performance:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">evaluate_router</span><span class="p">(</span><span class="n">router_function</span><span class="p">,</span> <span class="n">test_dataset</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluate a routing function against a test dataset.</span>

<span class="sd">    Args:</span>
<span class="sd">        router_function: Function that takes a query and returns tool selections</span>
<span class="sd">        test_dataset: List of {query, expected_tools} pairs</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary of evaluation metrics</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">tool_expected_count</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">tool_selected_count</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">tool_correct_count</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">test_case</span> <span class="ow">in</span> <span class="n">test_dataset</span><span class="p">:</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">test_case</span><span class="p">[</span><span class="s2">&quot;query&quot;</span><span class="p">]</span>
        <span class="n">expected_tools</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">test_case</span><span class="p">[</span><span class="s2">&quot;expected_tools&quot;</span><span class="p">])</span>

        <span class="c1"># Track expected tools</span>
        <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">expected_tools</span><span class="p">:</span>
            <span class="n">tool_expected_count</span><span class="p">[</span><span class="n">tool</span><span class="p">]</span> <span class="o">=</span> <span class="n">tool_expected_count</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tool</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># Get router predictions</span>
        <span class="n">selected_tools</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">router_function</span><span class="p">(</span><span class="n">query</span><span class="p">))</span>

        <span class="c1"># Track selected tools</span>
        <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">selected_tools</span><span class="p">:</span>
            <span class="n">tool_selected_count</span><span class="p">[</span><span class="n">tool</span><span class="p">]</span> <span class="o">=</span> <span class="n">tool_selected_count</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tool</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># Calculate precision and recall for this query</span>
        <span class="n">correct_tools</span> <span class="o">=</span> <span class="n">expected_tools</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">selected_tools</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">correct_tools</span><span class="p">:</span>
            <span class="n">tool_correct_count</span><span class="p">[</span><span class="n">tool</span><span class="p">]</span> <span class="o">=</span> <span class="n">tool_correct_count</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tool</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">precision</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">correct_tools</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_tools</span><span class="p">)</span> <span class="k">if</span> <span class="n">selected_tools</span> <span class="k">else</span> <span class="mf">1.0</span>
        <span class="n">recall</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">correct_tools</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">expected_tools</span><span class="p">)</span> <span class="k">if</span> <span class="n">expected_tools</span> <span class="k">else</span> <span class="mf">1.0</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">precision</span> <span class="o">*</span> <span class="n">recall</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">precision</span> <span class="o">+</span> <span class="n">recall</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">precision</span> <span class="o">+</span> <span class="n">recall</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>

        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">query</span><span class="p">,</span>
            <span class="s2">&quot;expected_tools&quot;</span><span class="p">:</span> <span class="n">expected_tools</span><span class="p">,</span>
            <span class="s2">&quot;selected_tools&quot;</span><span class="p">:</span> <span class="n">selected_tools</span><span class="p">,</span>
            <span class="s2">&quot;precision&quot;</span><span class="p">:</span> <span class="n">precision</span><span class="p">,</span>
            <span class="s2">&quot;recall&quot;</span><span class="p">:</span> <span class="n">recall</span><span class="p">,</span>
            <span class="s2">&quot;f1&quot;</span><span class="p">:</span> <span class="n">f1</span>
        <span class="p">})</span>

    <span class="c1"># Calculate overall metrics</span>
    <span class="n">avg_precision</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;precision&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
    <span class="n">avg_recall</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;recall&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
    <span class="n">avg_f1</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;f1&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

    <span class="c1"># Calculate per-tool recall</span>
    <span class="n">per_tool_recall</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">tool_expected_count</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">tool_expected_count</span><span class="p">[</span><span class="n">tool</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">per_tool_recall</span><span class="p">[</span><span class="n">tool</span><span class="p">]</span> <span class="o">=</span> <span class="n">tool_correct_count</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tool</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">tool_expected_count</span><span class="p">[</span><span class="n">tool</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">per_tool_recall</span><span class="p">[</span><span class="n">tool</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;detailed_results&quot;</span><span class="p">:</span> <span class="n">results</span><span class="p">,</span>
        <span class="s2">&quot;avg_precision&quot;</span><span class="p">:</span> <span class="n">avg_precision</span><span class="p">,</span>
        <span class="s2">&quot;avg_recall&quot;</span><span class="p">:</span> <span class="n">avg_recall</span><span class="p">,</span>
        <span class="s2">&quot;avg_f1&quot;</span><span class="p">:</span> <span class="n">avg_f1</span><span class="p">,</span>
        <span class="s2">&quot;per_tool_recall&quot;</span><span class="p">:</span> <span class="n">per_tool_recall</span><span class="p">,</span>
        <span class="s2">&quot;tool_expected_count&quot;</span><span class="p">:</span> <span class="n">tool_expected_count</span><span class="p">,</span>
        <span class="s2">&quot;tool_selected_count&quot;</span><span class="p">:</span> <span class="n">tool_selected_count</span><span class="p">,</span>
        <span class="s2">&quot;tool_correct_count&quot;</span><span class="p">:</span> <span class="n">tool_correct_count</span>
    <span class="p">}</span>
</code></pre></div>
<h3 id="analyzing-tool-selection-failures">Analyzing Tool Selection Failures</h3>
<p>When tool selection fails, we need to understand why. A confusion matrix is particularly useful here, showing which tools are being confused with one another.</p>
<p>For example, if we find that the <code>SearchBlueprint</code> tool is never being selected even when it should be, we might need to improve its description or add more examples to the system prompt.</p>
<h3 id="confusion-matrix-analysis">Confusion Matrix Analysis</h3>
<p>Imagine our evaluation produces this confusion matrix:</p>
<table>
<thead>
<tr>
<th>Expected\Selected</th>
<th>SearchText</th>
<th>SearchBlueprint</th>
<th>SearchSchedule</th>
</tr>
</thead>
<tbody>
<tr>
<td>SearchText</td>
<td>85</td>
<td>5</td>
<td>10</td>
</tr>
<tr>
<td>SearchBlueprint</td>
<td>40</td>
<td>50</td>
<td>10</td>
</tr>
<tr>
<td>SearchSchedule</td>
<td>15</td>
<td>5</td>
<td>80</td>
</tr>
</tbody>
</table>
<p>This shows that SearchBlueprint is frequently mistaken for SearchText, indicating that we need to better differentiate these tools.</p>
<h3 id="targeted-improvement-strategy">Targeted Improvement Strategy</h3>
<p>Once you've identified specific weaknesses in your router, you can implement targeted improvements:</p>
<ol>
<li><strong>For low-recall tools</strong>:</li>
<li>Add more few-shot examples for these tools</li>
<li>Improve tool descriptions to more clearly differentiate them</li>
<li>
<p>Consider whether these tools are truly distinct or should be merged</p>
</li>
<li>
<p><strong>For commonly confused tools</strong>:</p>
</li>
<li>Analyze failure cases to understand what's causing the confusion</li>
<li>Create "contrast examples" that explicitly show why similar queries go to different tools</li>
<li>
<p>Refine tool interfaces to have clearer boundaries</p>
</li>
<li>
<p><strong>For overall improvement</strong>:</p>
</li>
<li>Balance your few-shot examples across all tools</li>
<li>Include edge cases that test the boundaries between tools</li>
<li>Add multi-tool examples that show when multiple tools should be used together</li>
</ol>
<p><strong>Synthetic Data Generation for Router Testing:</strong></p>
<p>You can use synthetic data techniques to create comprehensive test cases for your router:</p>
<ol>
<li>Start with clear definitions of each tool's purpose</li>
<li>Use an LLM to generate diverse queries that should trigger each tool</li>
<li>Include variants of each query with slightly different wording</li>
<li>Generate ambiguous queries that could reasonably go to multiple tools</li>
<li>Create a balanced dataset that covers all tools proportionally</li>
</ol>
<p>This approach ensures comprehensive coverage of your router's decision space without requiring extensive manual labeling.</p>
<h2 id="user-interfaces-direct-tool-access">User Interfaces: Direct Tool Access</h2>
<p>One powerful insight from the routing architecture is that tools designed for language models can often be exposed directly to users as well. Just as Google offers specialized interfaces like Google Maps, YouTube, and Google Images alongside its main search, your RAG application can offer both:</p>
<ol>
<li>A natural language interface using the router</li>
<li>Direct access to specialized tools for specific needs</li>
</ol>
<blockquote>
<p><strong>Expert User Perspective:</strong> "When I know exactly what I need, a specialized tool is much faster than explaining it to a chatbot. But when I'm exploring new areas or have complex needs, the chat interface helps me discover what's possible."</p>
</blockquote>
<h3 id="dual-mode-ui-example">Dual-Mode UI Example</h3>
<p>Imagine a construction information system that offers:</p>
<ul>
<li>A chat interface for general questions</li>
<li>A blueprint search interface with date filters</li>
<li>A document search interface with type filters</li>
<li>A schedule search with timeline visualization</li>
<li>A permit lookup tool with status tracking</li>
</ul>
<p>These specialized interfaces map directly to the specialized retrievers we've built.</p>
<p>This dual-mode interface has several advantages:</p>
<ol>
<li><strong>Expert users</strong> can go directly to the tool they need</li>
<li><strong>New users</strong> can use natural language until they learn the system</li>
<li><strong>User interactions</strong> with direct tools provide training data for routing</li>
<li><strong>Clear capabilities</strong> help users understand what the system can do</li>
<li><strong>Control and transparency</strong> give users confidence in the results</li>
<li><strong>Performance optimization</strong> for common, well-defined tasks</li>
</ol>
<p><strong>UI Implementation Strategy:</strong></p>
<p>When implementing a dual-mode interface:</p>
<ol>
<li>Design specialized interfaces that match your existing tools' parameters</li>
<li>Create a unified entry point that offers both chat and specialized tool options</li>
<li>Add suggestions in chat responses that link to relevant specialized tools</li>
<li>Maintain consistent terminology between chat responses and tool interfaces</li>
<li>Track which interface users prefer for different query types</li>
</ol>
<h3 id="specialized-interface-examples">Specialized Interface Examples</h3>
<p>Here's how specialized interfaces might look for our construction information system:</p>
<h4 id="blueprint-search-interface">Blueprint Search Interface</h4>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/search/blueprints&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;GET&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Blueprint Search<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-group&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;description&quot;</span><span class="p">&gt;</span>Description:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span>
      <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span>
      <span class="na">id</span><span class="o">=</span><span class="s">&quot;description&quot;</span>
      <span class="na">name</span><span class="o">=</span><span class="s">&quot;description&quot;</span>
      <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;e.g., residential building, hospital, school&quot;</span>
    <span class="p">/&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-group&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;start-date&quot;</span><span class="p">&gt;</span>Start Date:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;date&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;start-date&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;start_date&quot;</span> <span class="p">/&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-group&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;end-date&quot;</span><span class="p">&gt;</span>End Date:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;date&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;end-date&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;end_date&quot;</span> <span class="p">/&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Search Blueprints<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</code></pre></div>
<h4 id="document-search-interface">Document Search Interface</h4>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/search/documents&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;GET&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Document Search<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-group&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;query&quot;</span><span class="p">&gt;</span>Search Terms:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span>
      <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span>
      <span class="na">id</span><span class="o">=</span><span class="s">&quot;query&quot;</span>
      <span class="na">name</span><span class="o">=</span><span class="s">&quot;query&quot;</span>
      <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;e.g., Johnson project, HVAC specifications&quot;</span>
    <span class="p">/&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-group&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;document-type&quot;</span><span class="p">&gt;</span>Document Type:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">select</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;document-type&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;document_type&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;</span>All Documents<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;contract&quot;</span><span class="p">&gt;</span>Contracts<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;proposal&quot;</span><span class="p">&gt;</span>Proposals<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;bid&quot;</span><span class="p">&gt;</span>Bids<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">select</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Search Documents<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</code></pre></div>
<p>These interfaces directly map to the tool interfaces we defined earlier, providing users with a clear, structured way to access the same capabilities available to the language model.</p>
<p>The key insight is that RAG isn't just about adding chat to your product—it's about building a comprehensive information discovery system where chat is just one interface option among many specialized tools that help users access information efficiently.</p>
<p><strong>Beyond Simple Forms:</strong></p>
<p>These specialized interfaces don't have to be simple forms. They can include rich visualizations, interactive elements, and specialized displays for different content types. For example, a blueprint search might display results on a timeline or a map, while a document search might offer faceted filters and previews. The key is that they map directly to your underlying retrieval tools.</p>
<h2 id="user-feedback-as-training-data">User Feedback as Training Data</h2>
<p>A particularly valuable aspect of direct tool access is that user interactions can provide high-quality training data for improving both retrieval and routing:</p>
<ol>
<li>When users select a specific tool, that's a signal about their intent</li>
<li>When users click on search results, that's a signal about relevance</li>
<li>When users refine their search, that's a signal about what was missing</li>
<li>When users explicitly rate or save results, that's direct feedback on quality</li>
</ol>
<h3 id="user-feedback-collection-mechanisms">User Feedback Collection Mechanisms</h3>
<p>To maximize the value of user feedback, consider implementing:</p>
<ul>
<li><strong>Tool Selection Tracking</strong>: Record which specialized tool a user chooses for each query</li>
<li><strong>Click Tracking</strong>: Monitor which search results users engage with</li>
<li><strong>Query Refinement Analysis</strong>: Capture how users modify queries that didn't yield useful results</li>
<li><strong>Explicit Feedback Buttons</strong>: Add "Was this helpful?" buttons to results</li>
<li><strong>Result Saving</strong>: Allow users to save or bookmark useful results</li>
<li><strong>Session Analysis</strong>: Examine session patterns to identify successful vs. unsuccessful paths</li>
</ul>
<p>These interactions can be logged and used to:</p>
<ul>
<li>Fine-tune embedding models with user-confirmed relevant documents</li>
<li>Improve router accuracy by learning from user tool selections</li>
<li>Create better few-shot examples based on successful interactions</li>
<li>Prioritize development efforts based on usage patterns</li>
<li>Identify gaps in your retrieval capabilities</li>
</ul>
<h3 id="implementing-a-feedback-loop">Implementing a Feedback Loop</h3>
<p>Here's how you might implement a feedback collection and utilization system:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">record_user_feedback</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">selected_tool</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">clicked_result_ids</span><span class="p">,</span> <span class="n">explicit_rating</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Record user feedback for future training data collection.</span>

<span class="sd">    Args:</span>
<span class="sd">        user_id: Identifier for the user</span>
<span class="sd">        query: The user&#39;s original query</span>
<span class="sd">        selected_tool: Which tool they used (or &#39;chat&#39; if they used the chat interface)</span>
<span class="sd">        results: The results returned to the user</span>
<span class="sd">        clicked_result_ids: Which result IDs the user clicked on</span>
<span class="sd">        explicit_rating: Optional explicit rating (1-5) provided by the user</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">feedback_entry</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
        <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
        <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">query</span><span class="p">,</span>
        <span class="s2">&quot;selected_tool&quot;</span><span class="p">:</span> <span class="n">selected_tool</span><span class="p">,</span>
        <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="n">results</span><span class="p">,</span>
        <span class="s2">&quot;clicked_result_ids&quot;</span><span class="p">:</span> <span class="n">clicked_result_ids</span><span class="p">,</span>
        <span class="s2">&quot;explicit_rating&quot;</span><span class="p">:</span> <span class="n">explicit_rating</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Store feedback in database</span>
    <span class="n">feedback_collection</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">feedback_entry</span><span class="p">)</span>

    <span class="c1"># If this was a highly-rated interaction, consider adding it to examples</span>
    <span class="k">if</span> <span class="n">explicit_rating</span> <span class="ow">and</span> <span class="n">explicit_rating</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">consider_adding_to_examples</span><span class="p">(</span><span class="n">feedback_entry</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">generate_training_data_from_feedback</span><span class="p">(</span><span class="n">min_clicks</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">min_rating</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">date_range</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate training data from collected user feedback.</span>

<span class="sd">    Args:</span>
<span class="sd">        min_clicks: Minimum number of clicks a result must have received</span>
<span class="sd">        min_rating: Minimum explicit rating (if available)</span>
<span class="sd">        date_range: Optional date range to filter feedback</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary with router_training_data and retrieval_training_data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Query conditions</span>
    <span class="n">conditions</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">min_rating</span><span class="p">:</span>
        <span class="n">conditions</span><span class="p">[</span><span class="s2">&quot;explicit_rating&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;$gte&quot;</span><span class="p">:</span> <span class="n">min_rating</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">date_range</span><span class="p">:</span>
        <span class="n">conditions</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;$gte&quot;</span><span class="p">:</span> <span class="n">date_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;$lte&quot;</span><span class="p">:</span> <span class="n">date_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]}</span>

    <span class="c1"># Retrieve feedback entries</span>
    <span class="n">feedback_entries</span> <span class="o">=</span> <span class="n">feedback_collection</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">conditions</span><span class="p">)</span>

    <span class="n">router_examples</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">retrieval_examples</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">feedback_entries</span><span class="p">:</span>
        <span class="c1"># Generate router training examples</span>
        <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;selected_tool&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;chat&quot;</span><span class="p">:</span>
            <span class="n">router_examples</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;query&quot;</span><span class="p">],</span>
                <span class="s2">&quot;tool&quot;</span><span class="p">:</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;selected_tool&quot;</span><span class="p">]</span>
            <span class="p">})</span>

        <span class="c1"># Generate retrieval training examples</span>
        <span class="k">for</span> <span class="n">result_id</span> <span class="ow">in</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;clicked_result_ids&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="s2">&quot;clicked_result_ids&quot;</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">min_clicks</span><span class="p">:</span>
                <span class="n">retrieval_examples</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;query&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;relevant_doc_id&quot;</span><span class="p">:</span> <span class="n">result_id</span>
                <span class="p">})</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;router_training_data&quot;</span><span class="p">:</span> <span class="n">router_examples</span><span class="p">,</span>
        <span class="s2">&quot;retrieval_training_data&quot;</span><span class="p">:</span> <span class="n">retrieval_examples</span>
    <span class="p">}</span>

<span class="k">def</span> <span class="nf">update_few_shot_examples</span><span class="p">(</span><span class="n">router_examples</span><span class="p">,</span> <span class="n">max_examples_per_tool</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update the few-shot examples used in the router based on user feedback.</span>

<span class="sd">    Args:</span>
<span class="sd">        router_examples: Router examples generated from feedback</span>
<span class="sd">        max_examples_per_tool: Maximum number of examples to keep per tool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Group examples by tool</span>
    <span class="n">examples_by_tool</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">example</span> <span class="ow">in</span> <span class="n">router_examples</span><span class="p">:</span>
        <span class="n">tool</span> <span class="o">=</span> <span class="n">example</span><span class="p">[</span><span class="s2">&quot;tool&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">tool</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">examples_by_tool</span><span class="p">:</span>
            <span class="n">examples_by_tool</span><span class="p">[</span><span class="n">tool</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">examples_by_tool</span><span class="p">[</span><span class="n">tool</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">example</span><span class="p">)</span>

    <span class="c1"># Select the best examples for each tool</span>
    <span class="n">selected_examples</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">tool</span><span class="p">,</span> <span class="n">examples</span> <span class="ow">in</span> <span class="n">examples_by_tool</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1"># Sort by frequency or other quality metric</span>
        <span class="n">sorted_examples</span> <span class="o">=</span> <span class="n">sort_examples_by_quality</span><span class="p">(</span><span class="n">examples</span><span class="p">)</span>
        <span class="n">selected_examples</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">sorted_examples</span><span class="p">[:</span><span class="n">max_examples_per_tool</span><span class="p">])</span>

    <span class="c1"># Update the router&#39;s few-shot examples</span>
    <span class="n">update_router_prompt</span><span class="p">(</span><span class="n">selected_examples</span><span class="p">)</span>
</code></pre></div>
<p>This creates another improvement flywheel: as users interact with the system, it collects data that makes both retrieval and routing better, which leads to higher user satisfaction and more interactions.</p>
<div class="admonition warning">
<p class="admonition-title">Feedback Biases</p>
</div>
<p>Be aware of potential biases in user feedback:</p>
<div class="highlight"><pre><span></span><code>1. **Position bias**: Users tend to click on top results regardless of relevance
2. **Interface bias**: Different interfaces encourage different interaction patterns
3. **User expertise bias**: Expert users interact differently than novices
4. **Success bias**: Successful interactions generate more feedback than failures

To mitigate these biases:
- Occasionally randomize result ordering for evaluation
- Analyze feedback separately across user expertise levels
- Specifically seek feedback on unsuccessful interactions
- Complement implicit feedback with explicit ratings
</code></pre></div>
<h2 id="success-formula">Success Formula</h2>
<p>System success depends on two factors:</p>
<div class="arithmatex">
<div class="MathJax_Preview">
P(\\text{success}) = P(\\text{find right document} \\mid \\text{right tool}) \\times P(\\text{right tool})
</div>
<script type="math/tex; mode=display">
P(\\text{success}) = P(\\text{find right document} \\mid \\text{right tool}) \\times P(\\text{right tool})
</script>
</div>
<p>This means:
1. Each retriever must work well when selected
2. The router must select the right retriever</p>
<h3 id="diagnostic-framework">Diagnostic Framework</h3>
<p>This formula helps diagnose problems:</p>
<ul>
<li>Low tool selection recall → improve routing</li>
<li>Low retrieval recall → improve specific retriever</li>
</ul>
<p><strong>Example:</strong> Imagine users report that when asking about blueprints, they only get satisfactory answers 40% of the time. There are two very different scenarios that could cause this:</p>
<p><strong>Scenario 1:</strong> The router correctly selects the blueprint search tool 95% of the time, but the blueprint search itself only finds the right blueprints 42% of the time.</p>
<ul>
<li>P(right tool) = 0.95</li>
<li>P(find right document | right tool) = 0.42</li>
<li>P(success) = 0.95 × 0.42 = 0.40 (40%)</li>
</ul>
<p><strong>Scenario 2:</strong> The blueprint search is excellent at finding the right blueprints 80% of the time when used, but the router only selects it 50% of the time (often choosing document search instead).</p>
<ul>
<li>P(right tool) = 0.50</li>
<li>P(find right document | right tool) = 0.80</li>
<li>P(success) = 0.50 × 0.80 = 0.40 (40%)</li>
</ul>
<p>Same 40% success rate, but completely different problems requiring different solution strategies:</p>
<p><strong>For Scenario 1 (retrieval problem):</strong></p>
<ul>
<li>Generate synthetic data to improve the blueprint search capability</li>
<li>Fine-tune embedding models specifically for blueprint content</li>
<li>Improve the extraction and structuring of blueprint metadata</li>
<li>Experiment with different chunking strategies for blueprints</li>
</ul>
<p><strong>For Scenario 2 (routing problem):</strong></p>
<ul>
<li>Add more few-shot examples showing when to use the blueprint tool</li>
<li>Improve the blueprint tool description to make it more distinctive</li>
<li>Add user feedback from successful interactions into your examples</li>
<li>Consider UI changes to help users explicitly request blueprints</li>
</ul>
<h3 id="independent-measurement">Independent Measurement</h3>
<p>Measure separately:
- <strong>Per-tool recall</strong>: Retriever success rate when used
- <strong>Tool selection accuracy</strong>: Router success rate</p>
<p>A dashboard with both metrics shows where to focus.</p>
<h3 id="from-metrics-to-roadmap">From Metrics to Roadmap</h3>
<p>This formula provides a clear framework for planning both product and research efforts:</p>
<table>
<thead>
<tr>
<th>P(success | right tool)</th>
<th>P(right tool | query)</th>
<th>Strategy</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>High</strong></td>
<td><strong>High</strong></td>
<td>These are strengths to highlight in your product</td>
</tr>
<tr>
<td><strong>Low</strong></td>
<td><strong>High</strong></td>
<td>Research focus needed on specific retrievers</td>
</tr>
<tr>
<td><strong>High</strong></td>
<td><strong>Low</strong></td>
<td>Focus on improving router or exposing tools directly</td>
</tr>
<tr>
<td><strong>Low</strong></td>
<td><strong>Low</strong></td>
<td>Consider whether this query type is worth supporting</td>
</tr>
</tbody>
</table>
<p>Systematic measurement and improvement of both components creates a continuous improvement cycle.</p>
<h2 id="summary">Summary</h2>
<p>This book covered systematic RAG improvement:</p>
<ol>
<li>Synthetic data for evaluation</li>
<li>Converting evaluations to training data</li>
<li>Feedback collection through UX</li>
<li>User segmentation and analysis</li>
<li>Specialized retrieval capabilities</li>
<li>Unified architecture with routing</li>
</ol>
<p>The result: a system that retrieves the right information using the right specialized capabilities.</p>
<p><strong>Core principle</strong>: Synthetic data and customer feedback are the fundamental building blocks. Everything else is implementation details that will evolve.</p>
<h3 id="the-improvement-process">The Improvement Process</h3>
<ol>
<li><strong>Measure</strong> performance by component</li>
<li><strong>Identify</strong> limiting factors</li>
<li><strong>Generate</strong> synthetic test data</li>
<li><strong>Implement</strong> targeted improvements</li>
<li><strong>Collect</strong> user feedback</li>
<li><strong>Repeat</strong> continuously</li>
</ol>
<p>This process works for first-time builders and experienced teams alike. Tools change; the process remains.</p>







  
  



  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../chapter6-2/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Tools">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Tools
              </div>
            </div>
          </a>
        
        
          
          <a href="../../office-hours/" class="md-footer__link md-footer__link--next" aria-label="Next: Office Hours">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Office Hours
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://x.com/jxnlco" target="_blank" rel="noopener" title="x.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["announce.dismiss", "navigation.instant", "navigation.tracking", "navigation.expand", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.footer", "search.highlight", "search.share", "search.suggest", "toc.follow", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.56ea9cef.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
    
  </body>
</html>